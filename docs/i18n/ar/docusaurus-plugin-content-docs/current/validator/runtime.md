---
title: وقت التشغيل (The Runtime)
---

## وقت التشغيل (The Runtime)

وقت التشغيل هو عبارة عن المُعالج المُتزامن للمُعاملات. تقوم المُعاملات بتحديد إعتمادات بياناتها مُسبقًا بحيث يكون تخصيص الذاكرة الديناميكية واضحًا. من خلال عزل ترميز البرنامج عن الحالة التي يعمل بها، يكون وقت التشغيل قادرًا على إجراء الوصول المُتزامن (choreograph concurrent access). يتم تفعيل الوصول إلى المُعاملات عن طريق حسابات للقراءة فقط (read-only accounts) بالتوازي، بينما يكون الوصول إلى الحسابات القابلة للتعديل تسلسليًا. يتفاعل وقت التشغيل مع البرنامج من خلال نقطة دخول بواجهة مُحَدَّدة جيدًا. تكون البيانات المُخزنة على حساب بنوع مُبهم، أو مجموعة من البايتات. يستطيع البرنامج التحكم بشكل كامل بمُحتوياته.

يُحَدِّد هيكل المُعاملة قائمة من المفاتيح العامة (public keys) والتواقيع الخاصة بهذه المفاتيح وقائمة مُتسلسلة من التعليمات التي تعمل على جميع الحالات المُرتبطة بمفاتيح الحسابات. لكي يتم تنفيذ المُعاملة، يجب أن تنفذ جميع الأوامر بنجاح؛ وأي فشل فيها يُؤدي إلى فشل تفيذ المُعاملة.

#### هيكل الحساب (Account Structure)

تحتفظ الحسابات برصيد lamport وذاكرة خاصة بالبرنامج.

## مُحَرِّك المُعاملات (Transaction Engine)

يقوم المُحرك بتعيين المفاتيح العامة (public keys) للحسابات وتوجيهها إلى نقطة دخول البرنامج.

### التنفيذ (Execution)

يتم تجميع المُعاملات ومُعالجتها في خط الأنابيب (pipeline). يتبع TPU و TVU مسارًا مُختلفًا قليلاً. يضمن وقت تشغيل TPU حدوث سجل PoH قبل تخصيص الذاكرة.

يضمن وقت تشغيل TVU حدوث التَحَقُّق من PoH قبل أن يُعالج وقت التشغيل أي مُعاملات.

![Runtime pipeline](/img/runtime.svg)

في مرحلة التنفيذ _execute_ ، لا تحتوي الحسابات المُحمّلة على تبعيات للبيانات، لذلك يُمكن تنفيذ جميع البرامج بشكل مُتوازٍ.

يفرض وقت التشغيل القواعد التالية:

1. يحق فقط لمالك _owner_ البرنامج تعديل مُحتويات الحساب. هذا يعني أن ناقلات البيانات عند التعيين مضمونة بأن تكون صفرا.
2. إجمالي الأرصدة في جميع الحسابات مُتساوٍ قبل تنفيذ المُعاملة وبعدها.
3. بعد تنفيذ المُعاملة، يجب أن تكون أرصدة الحسابات للقراءة فقط (read-only accounts) مُساوية للأرصدة قبل المُعاملة.
4. يتم تنفيذ جميع التعليمات الواردة في المُعاملة بشكل تلقائي. إذا فشل أحدها، يتم تجاهل جميع تعديلات الحساب.

يتضمن تنفيذ البرنامج تعيين المفتاح العام للبرنامج (program's public key) إلى نقطة الدخول التي تأخذ مُؤشرًا إلى المُعاملة، ومجموعة من الحسابات المُحمّلة.

### واجهة برنامج النظام (SystemProgram Interface)

أفضل وصف للواجهة هو `Instruction::data` التي يقوم المُستخدم بترميزها.

- إنشاء حساب ` CreateAccount ` - يتيح ذلك للمُستخدم إنشاء حساب بمصفوفة بيانات مُخَصَّصَة وتعيينه إلى أحد البرامج.
- إنشاء حساب بالبذور ` CreateAccountWithSeed ` - مثل إنشاء حساب ` CreateAccount `، لكن عنوان الحساب الجديد هو
  - المفتاح العمومي (pubkey) لحساب التمويل،
  - سلسلة الرموز المُختصرة (mnemonic string)، و
  - المفتاح العمومي (pubkey) الخاص بالبرنامج
- تعيين `Assign` - يسمح للمُستخدم بتعيين حساب موجود لأحد البرامج.
- تحويل `Transfer` - ينقل الـ lamports بين الحسابات.

### برنامج أمن الحالة (Program State Security)

لكي يعمل البلوكشاين بشكل صحيح، يجب أن يكون رمز البرنامج مرنًا لإدخالات المُستخدم. هذا هو السبب في أن الكود الخاص بالبرنامج في هذا التصميم هو الرمز الوحيد الذي يُمكنه تغيير حالة مصفوفة بايت البيانات في الحسابات المُخَصَّصَة لها. وهو أيضًا السبب الذي يجعل التعيين `Assign` أو إنشاء حساب ` CreateAccount ` يجب أن يستبعد البيانات. خلاف ذلك، لن تكون هناك طريقة مُمكنة للبرنامج للتمييز بين بيانات الحساب المُعَيَّنة مُؤخرًا من إنتقال الحالة الذي تم إنشاؤه محليًا دون بعض البيانات الوصفية الإضافية من وقت التشغيل للإشارة إلى أن هذه الذاكرة مُخَصَّصَة بدلاً من إنشاؤها محليًا.

لتمرير الرسائل بين البرامج، يجب أن يقبل البرنامج المُتَلَقَّي الرسالة ونسخ الحالة. لكن من الناحية العملية، لا تُوجد حاجة إلى نُسخة وهي غير مرغوب فيها. يُمكن للبرنامج المُتَلَقَّي (receiving program) قراءة الحالة التي تنتمي إلى حسابات أخرى دون نسخها، وخلال القراءة يكون لديه ضمان لحالة البرنامج المُرسل (sender program's state).

### المُلاحظات

- لا يُوجد تخصيص للذاكرة الديناميكية. يحتاج العميل إلى إستخدام إرشادات إنشاء حساب `CreateAccount` لإنشاء ذاكرة قبل تمريرها إلى برنامج آخر. يُمكن أن تتكون هذه التعليمات في مُعاملة واحدة مع إستدعاء البرنامج نفسه.
- يضمن إنشاء حساب `CreateAccount` و التعيين `Assign` أنه عند تعيين الحساب للبرنامج، يتم تهيئة بيانات الحساب إلى الصفر.
- يجب توقيع المُعاملات التي تعين حسابًا لبرنامج أو تُخَصّص مساحة عن طريق المفتاح الخاص (private key) لعنوان الحساب ما لم يتم إنشاء الحساب بواسطة إنشاء حساب بالبذور ` CreateAccountWithSeed `، وفي هذه الحالة لا يوجد مفتاح خاص (private key) مُطابق لعنوان الحساب / المفتاح العمومي (pubkey).
- بمُجرد تعيين الحساب للبرنامج لا يُمكن إعادة تعيينه.
- يضمن وقت التشغيل أن رمز البرنامج هو الرمز الوحيد الذي يُمكنه تعديل بيانات الحساب التي تم تعيين الحساب لها.
- يضمن وقت التشغيل أن البرنامج يُمكنه فقط إنفاق الـ lamports الموجودة في الحسابات المُخَصَّصَة له.
- يضمن وقت التشغيل مُوازنة الأرصدة الخاصة بالحسابات قبل المُعاملة وبعدها.
- يضمن وقت التشغيل تنفيذ جميع التعليمات بنجاح عند تنفيذ المُعاملة.

## الأعمال المُستقبلية

- [الإستمرارية والإشارات للمُعاملات طويلة الأمد](https://github.com/solana-labs/solana/issues/1485)
