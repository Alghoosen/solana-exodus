---
title: "وقت التشغيل"
---

## قُدرة البرامج (Capability of Programs)

يسمح وقت التشغيل فقط لمالك البرنامج بسحب الحساب أو تعديل بياناته. ثم يحدد البرنامج قواعد إضافية إذا ما يُمكن للعميل تعديل الحسابات التي يمتلكها. في حالة برنامج النظام، فإنه يسمح للمستخدمين بنقل الـ lamports من خلال التعرف على توقيعات المُعاملات. إذا رأى العميل يُوقِّع المُعاملة بإستخدام المفتاح الخاص _private key_، فإنه يعرف أن العميل أذن بعملية نقل الرمز.

بعبارة أخرى، يُمكن إعتبار المجموعة الكاملة للحسابات المملوكة لبرنامج معين بمثابة مخزن ذي قيمة رئيسية حيث يكون المفتاح هو عنوان الحساب والقيمة هي البيانات الثنائية التعسفية الخاصة بالبرنامج. يُمكن لمؤلف البرنامج أن يُقرر كيفية إدارة حالة البرنامج بالكامل مثل العديد من الحسابات المُحتملة.

بعد أن يُنفذ وقت التشغيل كل تعليمات المُعاملة، يستخدم البيانات الوصفية للحساب للتحقق من عدم إنتهاك سياسة الوصول. في حالة إنتهاك أحد البرامج للسياسة، يتجاهل وقت التشغيل جميع تغييرات الحساب التي تم إجراؤها بواسطة جميع التعليمات الواردة في المُعاملة ويضع علامة على المُعاملة على أنها فاشلة.

### السياسة (Policy)

بعد أن يقوم البرنامج بمُعالجة التعليمات، يتحقق وقت التشغيل من أن البرنامج قام فقط بالعمليات المسموح بها، وأن النتائج تلتزم بسياسة وقت التشغيل.

وتتمثل السياسة العامة فيما يلي:

- فقط مالك الحساب يمكنه تغيير مالكه.
  - فقط إذا كان الحساب قابل للكتابة.
  - فقط إذا كان الحساب غير قابل للتنفيذ
  - فقط إذا كانت البيانات غير مُهيئة أو فارغة.
- الحساب غير المُعين للبرنامج لا يُمكن أن ينخفض رصيده.
- قد لا يتغير رصيد الحسابات القابلة للقراءة فقط (read-only) والحسابات القابلة للتنفيذ.
- يمكن لبرنامج النظام فقط تغيير حجم البيانات وفقط إذا كان برنامج النظام يمتلك الحساب.
- يجوز للمالك فقط تغيير بيانات الحساب.
  - فقط إذا كان الحساب قابل للكتابة.
  - فقط إذا كان الحساب غير قابل للتنفيذ.
- قابل للتنفيذ بإتجاه واحد (false->true) ويُمكن لمالك الحساب فقط تعيينه.
- لا يُوجد تعديل واحد على فترة الإيجار (rent_epoch) المُرتبط بهذا الحساب.

## حساب الميزانية (Compute Budget)

لمنع برنامج من إساءة إستخدام موارد الحساب، يتم إعطاء كل تعليمة في مُعاملة ميزانية حسابية. تتكون الميزانية من وحدات حسابية يتم إستهلاكها أثناء قيام البرنامج بتنفيذ العديد من العمليات والحدود التي لا يجوز للبرنامج تجاوزها. عندما يستهلك البرنامج ميزانيته بالكامل أو يتجاوز حدًا، فإن وقت التشغيل يُوقف البرنامج ويعيد خطأ.

العمليات التالية تقوم بعملية حساب التكلفة:

- تنفيذ تعليمات BPF
- إستدعاء مكالمات النظام (Calling system calls)
  - التسجيل
  - إنشاء عناوين البرنامج
  - الإستدعاءات عبر البرامج (cross-program invocations)
  - ...

بالنسبة للإستدعاءات عبر البرامج (cross-program invocations)، ترث البرامج التي تم إستدعاءها ميزانية البرنامج الرئيسي. إذا كان البرنامج الذي تم إستدعاؤه يستهلك الميزانية أو يتجاوز حدًا، يتم إيقاف سلسلة الإستدعاء بأكملها ويتم إيقاف البرنامج الرئيسي.

يُمكن العثور على حوسبة الميزانية [compute budget](https://github.com/solana-labs/solana/blob/d3a3a7548c857f26ec2cb10e270da72d373020ec/sdk/src/process_instruction.rs#L65) الحالي في الـ ـSDK الخاصة بـ Solana.

على سبيل المثال، إذا كانت الميزانية الحالية كما يلي:

```rust
max_units: 200,000,
log_units: 100,
log_u64_units: 100,
create_program address units: 1500,
invoke_units: 1000,
max_invoke_depth: 4,
max_call_depth: 64,
stack_frame_size: 4096,
log_pubkey_units: 100,
```

سيكون البرنامج

- يمكن تنفيذ تعليمات 200,000 BPF إذا لم تفعل شيئًا آخر
- يمكن تسجيل 2,000 رسالة سجل
- لا يمكن أن يتجاوز إستخدام المُكدس 4k
- لا يُمكن أن يتجاوز عمق مكالمة BPF الـ 64
- لا يمكن أن يتجاوز 4 مستويات للإستدعاءات عبر البرامج (Cross-Program Invocations).

نظرًا لإستهلاك الميزانية المحسوبة بشكل متزايد أثناء تنفيذ البرنامج، فإن إجمالي إستهلاك الميزانية سيكون مزيجًا من التكاليف المختلفة للعمليات التي يقوم بها.

قد يُسجل البرنامج في وقت التشغيل المقدار المتبقي من الميزانية المحسوبة. See [debugging](developing/on-chain-programs/debugging.md#monitoring-compute-budget-consumption) for more information.

قيم الميزانية مشروطة بتمكين الميزة، ألق نظرة على وظيفة حوسبة الميزانية [new](https://github.com/solana-labs/solana/blob/d3a3a7548c857f26ec2cb10e270da72d373020ec/sdk/src/process_instruction.rs#L97) لمعرفة كيفية إنشاء الميزانية. يلزم فهم كيفية عمل الميزات [features](runtime.md#features) التي يتم تنشيطها في المجموعة (cluster) المُستخدمة لتحديد قِيَم الميزانية الحالية.

## ميزات جديدة (New Features)

مع تطور Solana، قد يتم تقديم ميزات أو تصحيحات جديدة تُغير سلوك المجموعة وكيفية تشغيل البرامج. يجب تنسيق التغييرات في السلوك بين العقد المختلفة للمجموعة، إذا لم تنسق العُقد (nodes)، فيمكن أن تُؤدي هذه التغييرات إلى إنهيار الإجماع (consensus). تدعم Solana آلية تسمى ميزات وقت التشغيل (runtime features) لتسهيل التبني السلس للتغييرات.

تعد ميزات وقت التشغيل (Runtime features) أحداثًا مُنسقة بين فترات زمنية (epoch) حيث سيحدث تغيير سلوك واحد أو أكثر في المجموعة (cluster). التغييرات الجديدة التي تم إجراؤها على Solana والتي من شأنها تغيير السلوك مُغلفة ببوابات ميزة ويتم تعطيلها بشكل إفتراضي. يتم إستخدام أدوات Solana بعد ذلك لتنشيط ميزة، والتي تحددها في وضع مُعلق (pending)، بمجرد وضع علامة مُعلقة (pending)، سيتم تنشيط الميزة في الفترة (epoch) التالية.

لتحديد الميزات التي تم تنشيطها، إستخدم [Solana command-line tools](cli/install-solana-cli-tools.md):

```bash
وضع ميزة solana
```

إذا واجهت مشاكل أولاً، فتأكد من أن إصدار أدوات Solana التي تستخدمها يطابق الإصدار الذي تم إرجاعه بواسطة `solana cluster-version`. إذا كانت لا تتطابق مع إذا كانت لا تتطابق مع [install the correct tool suite](cli/install-solana-cli-tools.md).
