---
title: "المُعاملات (Transactions)"
---

يبدأ تنفيذ البرنامج بـ [transaction](terminology.md#transaction) التي يتم تقديمها إلى المجموعة (cluster). سينفذ وقت تشغيل Solana برنامجًا لمعالجة كل من [instructions](terminology.md#instruction) الواردة في المُعاملة، بالترتيب وبشكل ذري.

## تشريح المُعاملة (Anatomy of a Transaction)

يُغطي هذا القسم التنسيق الثنائي للمُعاملة.

### تنسيق المُعاملة (Transaction Format)

تحتوي المُعاملة على مجموعة مُدمجة [compact-array](#compact-array-format) من التوقيعات، تليها رسالة [message](#message-format). كل عنصر في مصفوفة التواقيع هو توقيع إلكتروني [digital signature](#signature-format) من الرسالة المُحَدَّدة. يتحقق وقت تشغيل Solana من أن عدد التوقيعات يطابق الرقم الموجود في أول 8 bits من رأس الرسالة [message header](#message-header-format). كما يتحقق من أن كل توقيع تم توقيعه بواسطة المفتاح الخاص (private key) المقابل للمفتاح العمومي (public key) في نفس الفهرس في مصفوفة عناوين حساب الرسالة.

#### تنسيق التوقيع (Signature Format)

يكون كل توقيع رقمي بالتنسيق الثنائي ed25519 ويستهلك 64 bytes.

### تنسيق الرسالة (Message Format)

تحتوي الرسالة على [header](#message-header-format)، متبوعة بمصفوفة مضغوطة من عناوين الحساب [account addresses](#account-addresses-format)، متبوعة بمجموعة حديثة لتجزئة الكُتلة [blockhash](#blockhash-format)، متبوعة بمصفوفة مضغوطة من التعليمات [instructions](#instruction-format).

#### تنسيق رأس الرسالة (Message Header Format)

يحتوي رأس الرسالة على ثلاث قيم 8-bit غير مُوقَّعة. القيمة الأولى هي عدد التوقيعات المطلوبة في المُعاملة التي تحتوي عليها. القيمة الثانية هي عدد عناوين الحساب المُطابقة التي تكون للقراءة فقط (read-only). القيمة الثالثة في رأس الرسالة هي عدد عناوين الحساب للقراءة فقط (read-only) التي لا تتطلب توقيعات.

#### تنسيق عناوين الحساب (Account Addresses Format)

تظهر العناوين التي تتطلب تواقيع في بداية مصفوفة عناوين الحساب، مع العناوين التي تطلب حق الوصول للكتابة أولاً ثم وتليها الحسابات القابلة للقراءة فقط (read-only). العناوين التي لا تتطلب توقيعات تتبع العناوين التي تتطلب توقيعات، مرة أخرى مع حسابات القراءة والكتابة (read-write) أولاً متبوعة بحسابات القراءة فقط (read-only).

#### تنسيق تجزئة الكتلة (Blockhash Format)

تحتوي تجزئة الكتلة (blockhash) على تجزئة SHA-256 بحجم 32-byte. يتم إستخدامه للإشارة إلى آخر مرة لاحظ فيها العميل دفتر الأستاذ (ledger). سيرفض المُدققون (validators) المُعاملات عندما تكون تجزئة الكتلة (blockhash) قديمة جدًا.

### تنسيق التعليمات (Instruction Format)

تحتوي التعليمات على فهرس مُعرف البرنامج (program id)، متبوعًا بمصفوفة مضغوطة من فهارس عناوين الحساب، متبوعة بمصفوفة مضغوطة من البيانات المُبهمة 8-bit. يتم إستخدام فهرس مُعرّف البرنامج لتحديد برنامج على الشبكة (On-Chain) يُمكنه تفسير البيانات المُبهمة (opaque data). فهرس مُعرّف البرنامج عبارة عن فهرس 8-bit غير مُوقَّعة لعنوان حساب في رسالة مجموعة عناوين الحساب. فهارس عنوان الحساب كل منها عبارة عن فهرس 8-bit بدون إشارة إلى نفس المصفوفة.

### تنسيق المصفوفة المضغوطة (Compact-Array Format)

يتم إجراء تسلسل للمصفوفة المضغوطة (Compact-Array) على أنها طول الصفيف، متبوعًة بكل عنصر في المصفوفة. طول المصفوفة هو ترميز خاص مُتعدد الـ byte يُسمى مضغوط u16 أو Compact-u16 Format.

#### مضغوط u16 أو Compact-u16 Format

مضغوط u16 أو Compact-u16 هو ترميز مُتعدد الـ byte متكون من 16 bits. يحتوي الـ byte الأول على عدد 7 bits أقل من القيمة في 7 bits الأقل. إذا كانت القيمة أعلى من 0x7f، يتم تعيين الـ bit العالي ويتم وضع الـ 7 bits التالية من القيمة في 7 bits الأقل من الـ bits للـ byte الثاني. إذا كانت القيمة أعلى من 0x3fff، يتم تعيين الـ bit العالي ويتم وضع الـ 2 bits المتبقيتين من القيمة في الـ 2 bits السفليتين من الـ byte الثالث.

### تنسيق عنوان الحساب (Account Address Format)

عنوان الحساب هو 32-bytes من البيانات العشوائية. عندما يتطلب العنوان توقيعًا رقميًا، يُفسره وقت التشغيل على أنه المفتاح العمومي (public key) لزوج المفاتيح ed25519.

## التعليمات (Instructions)

تُحدد كل تعليمة [instruction](terminology.md#instruction) برنامجًا واحدًا، ومجموعة فرعية من حسابات المُعاملة التي يجب تمريرها إلى البرنامج، ومصفوفة بيانات الـ byte التي يتم تمريرها إلى البرنامج. يفسر البرنامج مصفوفة البيانات ويعمل على الحسابات المُحددة في التعليمات. يمكن للبرنامج الإرجاع بنجاح، أو برمز رسالة خطأ. يُؤدي إرجاع الخطأ إلى فشل المُعاملة بالكامل على الفور.

يُوفر البرنامج عادةً وظائف مُساعدة لبناء التعليمات التي يدعمونها. على سبيل المثال، يُوفر برنامج النظام مساعد Rust التالي لإنشاء تعليمة [`SystemInstruction::CreateAccount`](https://github.com/solana-labs/solana/blob/6606590b8132e56dab9e60b3f7d20ba7412a736c/sdk/program/src/system_instruction.rs#L63):

```rust
pub fn create_account(
    from_pubkey: &Pubkey,
    to_pubkey: &Pubkey,
    lamports: u64,
    space: u64,
    owner: &Pubkey,
) -> Instruction {
    let account_metas = vec![
        AccountMeta::new(*from_pubkey, true),
        AccountMeta::new(*to_pubkey, true),
    ];
    Instruction::new(
        system_program::id(),
        &SystemInstruction::CreateAccount {
            lamports,
            space,
            owner: *owner,
        },
        account_metas,
    )
}
```

الذي يمكن العثور عليه هنا:

https://github.com/solana-labs/solana/blob/6606590b8132e56dab9e60b3f7d20ba7412a736c/sdk/program/src/system_instruction.rs#L220

### مُعرف البرنامج (Program Id)

يُحدد مُعرف البرنامج [program id](terminology.md#program-id) الخاص بالإرشادات البرنامج الذي سيُعالج هذه التعليمة. يُحدد مالك حساب البرنامج المُحمّل (Loader) الذي يجب إستخدامه لتحميل البرنامج وتنفيذه وتحتوي البيانات على معلومات حول كيفية تنفيذ وقت التشغيل للبرنامج.

في حالة برامج BPF المنشورة [deployed BPF programs](developing/deployed-programs/overview.md)، يكون المالك هو مُحمّل BPF وبيانات الحساب تحتفظ بالـ bytecode الخاص بالـ BPF.  يتم تمييز حسابات البرنامج بشكل دائم على أنها قابلة للتنفيذ بواسطة المُحمّل (Loader) بمجرد نشرها بنجاح. سيرفض وقت التشغيل المُعاملات التي حدد البرامج غير القابلة للتنفيذ.


على عكس البرامج التي تم نشرها، يتم التعامل مع [builtins](developing/builtins/programs.md) بشكل مُختلف من حيث أنها مُدمجة مُباشرة في وقت تشغيل Solana.

### الحسابات (Accounts)

تُمثل الحسابات المُشار إليها بواسطة التعليمات حالة على الشبكة (on-chain) وتعمل كمُدخلات (inputs) ومُخرجات (outputs) للبرنامج. يُمكن العثور على مزيد من المعلومات حول الحسابات في قسم الحسابات [Accounts ](accounts.md).

### تنسيق التعليمات (Instruction data)

كل تعليمة تحمل مصفوفة byte للأغراض العامة يتم تمريرها إلى البرنامج مع الحسابات. مُحتويات بيانات التعليمات خاصة بالبرنامج وتُستخدم عادةً للتعبير عن العمليات التي يجب أن يقوم بها البرنامج وأي معلومات إضافية قد تحتاجها هذه العمليات بالإضافة إلى ما تحتويه الحسابات.

البرامج حرة في تحديد كيفية تشفير المعلومات في مصفوفة بيانات byte التعليمات. يجب أن يأخذ إختيار كيفية تشفير البيانات في الإعتبار النفقات العامة لفك الترميز منذ أن يتم تنفيذ هذه الخطوة بواسطة البرنامج على الشبكة (on-chain). لقد لوحظ أن بعض الترميزات الشائعة (على سبيل المثال Rust's bincode) غير فعالة للغاية.

يُعطي [Solana Program Library's Token program](https://github.com/solana-labs/solana-program-library/tree/master/token) مثالاً واحدًا على كيفية تشفير بيانات التعليمات بكفاءة، لكن لاحظ أن هذه الطريقة تدعم فقط الأنواع ذات الحجم الثابت. يُستخدم الرمز السمة [Pack](https://github.com/solana-labs/solana/blob/master/sdk/program/src/program_pack.rs) لترميز / فك تشفير بيانات التعليمات لكل من تعليمات الرمز وكذلك حالات حساب الرمز.

## التوقيعات (Signatures)

تسرد كل مُعاملة صراحةً جميع المفاتيح العمومية (public keys) للحساب المُشار إليها في تعليمات المُعاملة. كل مجموعة فرعية من هذه المفاتيح العمومية (public keys) مصحوبة بتوقيع المُعاملة. تُشير تلك التواقيع إلى البرامج الموجودة على الشبكة (On-Chain) التي تُفيد بأن صاحب الحساب أذن بالمعاملة. عادةً ما يستخدم البرنامج التفويض للسماح بخصم الحساب أو تعديل بياناته. تُمكن العثور على مزيد من المعلومات حول كيفية توصيل التفويض إلى برنامج في الحسابات [Accounts](accounts.md#signers)


## تجزئة الكتلة الحديثة (Recent Blockhash)

تتضمن المُعاملة رقم تجزئة الكُتلة [blockhash](terminology.md#blockhash) حديثًا لمنع الإزدواجية وإعطاء عمر للمُعاملات. يتم رفض أي مُعاملة مُطابقة تمامًا لمُعاملة سابقة، لذا فإن إضافة تجزئة كتلة (Blockhash) أحدث يسمح للمُعاملات المُتعددة بتكرار نفس الإجراء بالضبط. المُعاملات أيضًا لها فترات عمر مُحددة بواسطة تجزئة الكتلة (Blockhash)، حيث سيتم رفض أي مُعاملة يتكون تجزئة كتلتها (Blockhash) قديمًا جدًا.
