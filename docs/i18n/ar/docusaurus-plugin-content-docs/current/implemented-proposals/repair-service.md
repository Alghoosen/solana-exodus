---
title: خدمة الإصلاح (Repair Service)
---

## خدمة الصيانة (Repair Service)

تتولى خدمة الصيانة (RepairService) مسؤولية إسترداد الأجزاء المفقودة التي فشل تسليمها بواسطة بروتوكولات الإتصال الأساسية مثل التوربين (Turbine). إنه مسؤول عن إدارة البروتوكولات المُوضحة أدناه في قسم بروتوكولات الإصلاح `Repair Protocols` أدناه.

## التحديات (Challenges):

1\) يمكن أن يفشل المُدقّقون (validators) في تلقي أشلاء صغيرة مُعينة بسبب فشل الشبكة

2\) ضع في إعتبارك سيناريو حيث يحتوي مخزن الكتلة (blockstore) على مجموعة الفتحات {1, 3, 5}. ثم يتلقى مخزن الكتلة (blockstore) أشلاء صغيرة لبعض الفتحة عدد 7، حيث لكل من الأجزاء المقطوعة b، حيث يمثل والد b أو b.parent العدد 6 أو b.parent == 6، وبالتالي فإن العلاقة بين الوالدين والطفل 6 -&gt; 7 يتم تخزين 7 في مخزن الكتلة (blockstore). مع ذلك، لا تُوجد طريقة لربط هذه الفُتحات (Slots) بأي من البنوك الموجودة في مخزن الكتلة (blockstore)، وبالتالي لن يقوم بروتوكول إصلاح الشظايا `Shred Repair` بإصلاح هذه الفُتحات (Slots). إذا كانت هذه الفُتحات (Slots) جزءًا من الشبكة الرئيسية، فسيؤدي ذلك إلى إيقاف تقدم إعادة التشغيل على هذه العُقدة (node).

## الأوليات المُتعلقة بالإصلاح (Repair-related primitives)

فترة الفُتحات (Epoch Slots): يُعلن كل مُدقّق (validator) بشكل مُنفصل عن القيل والقال (gossip) المختلفة من فترة الفُتحات `Epoch Slots`:

- المخبأ `stash`: مجموعة مضغوطة مُدتها فترة (epoch) من جميع الفُتحات (slots) المُكتملة.
- ذاكره التخزين المُؤقت `cache`: تشفير طول التشغيل (RLE) لآخر فُتحة `N` مُكتملة تبدأ من بعض الفُتحة `M`، حيث `N` هو عدد الفُتحات التي تُناسب حزمة بحجم MTU.

يتم تحديث فترة الفُتحات `Epoch Slots` في القيل والقال (gossip) في كل مرة يتلقى فيها المُدقّق (validator) فتحة كاملة خلال الفترة (epoch). يتم إكتشاف الفُتحات المُكتملة بواسطة مخزن الكتلة (blockstore) وإرسالها عبر قناة إلى خدمة الصيانة (RepairService). من المهم مُلاحظة أننا نعلم أنه بحلول الوقت الذي تكتمل فيه الفُتحة `X`، يجب أن يكون جدول الفترة (epoch) موجودًا للفترة التي تحتوي على الفُتحة `X` لأن WindowService سترفض الأشلاء المقطوعة لفترات غير مُؤكدة.

كل `N/2` فُتحة مُكتملة، يتم نقل أقدم `N/2` فُتحة من ذاكره التخزين المُؤقت `cache` إلى المخبأ `stash`. يجب أيضًا تحديث القيمة الأساسية `M` لـ RLE.

## بروتوكولات طلب الإصلاح (Repair Request Protocols)

يبذل بروتوكول الإصلاح أفضل المُحاولات لإحراز تقدم في بنية الإنقسام أو الشوكة (fork) لمخزن الكتلة (blockstore).

إستراتيجيات البروتوكول المُختلفة لمُواجهة التحديات المذكورة أعلاه:

1. إصلاح الأشلاء \ (تحدي العناوين \#1\): هذا هو بروتوكول الإصلاح الأساسي، بهدف إكتشاف وملء "الثقوب" في دفتر الأستاذ (ledger). يتتبع مخزن الكتلة (blockstore) أحدث فُتحة جذر (root slot). ستقوم خدمة الصيانة (RepairService) بعد ذلك بتكرار كل إنقسام أو شوكة (fork) في مخزن الكتلة (blockstore) بشكل دوري بدءًا من فُتحة الجذر (root slot)، وإرسال طلبات الإصلاح إلى المُدقّقين (validators) بحثًا عن أي أشلاء مفقودة. سيرسل بحد أقصى `N` طلب إصلاح لكل تكرار. يجب أن يُعطي إصلاح الأشلاء الأولوية لإصلاح الإنقسامات أو الشوكات (forks) بناءً على وزن إنقسام أو شوكة القائد. يجب على المُدقّقين (validators) إرسال طلبات الإصلاح فقط إلى المُدقّقين الذين وضعوا علامة على تلك الفُتحة (Slot) على أنها مُكتملة في فترة الفُتحة (EpochSlot) الخاصة بهم. يجب على المُدقّقين (validators) إعطاء الأولوية لإصلاح القطع في كل فُتحة (Slot) يكونون مسؤولين عنها لإعادة الإرسال عبر التوربين (turbine). يُمكن للمُدقّقين (validators) حساب الأشلاء التي تكون مسؤولة عن إعادة إرسالها لأن بذرة التوربين (turbine) تعتمد على مُعرف القائد (leader id) والفُتحة (Slot) ومُؤشر التقطيع.

   مُلاحظة: لن يقبل المُدقّقون (validators) سوى الأشلاء الصغيرة الموجودة في الفترة (epoch) الحالية القابلة للتحقق \ (فترة المُدقّق التي تحتوي على جدول القائد لـ\).

2. الإصلاح الوقائي للفُتحة \ (تحدي العناوين \#2\): الهدف من هذا البروتوكول هو إكتشاف علاقة التسلسل للفُتحات "المعزولة" التي لا ترتبط حاليًا بأي إنقسام أو شوكة (fork) معروف. يجب أن يُعطي إصلاح الأشلاء الأولوية لإصلاح الفُتحات "المعزولة" (orphan slots) بناءً على وزن إنقسام أو شوكة (fork) القائد.

   - سيتتبع مخزن الكتلة (blockstore) مجموعة الفُتحات "المعزولة" (orphan slots) في عائلة أعمدة مُنفصلة.
   - ستقدم خدمة الصيانة (RepairService) بشكل دوري بطلب طلبات معزولة `Orphan` لكل من الأيتام (orphans) في مخزن الكتلة (blockstore).

     `Orphan(orphan)` طلب الـ - `orphan` هو الفُتحة اليتيمة (orphan slot) التي يُريد مُقدم الطلب معرفة آباء `Orphan(orphan)`- أعلى أشلاء لكل من أول `N` أولياء الـ `orphan` المطلوب

     عند تلقي الردود `p`، حيث يكون `p` عبارة عن تمزيق في الفُتحة الرئيسية، فإن المُدقّقين (validators) سوف:

     - قُم بإدخال `SlotMeta` فارغًا في مخزن الكتلة (blockstore) لـ `p.slot` إذا لم يكن موجودًا بالفعل.
     - إذا كان `p.slot` موجودًا، فقُم بتحديث أصل `p` بناءً على `parents`

     مُلاحظة: بمجرد إضافة هذه الفُتحات الفارغة إلى مخزن الكتلة (blockstore)، يجب أن يُحاول بروتوكول إصلاح الشظايا `Shred Repair` ملء تلك الفُتحات.

     مُلاحظة: لن يقبل المُدقّقون (validators) إلا الردود التي تحتوي على أشلاء صغيرة ضمن الفترة (epoch) الحالية القابلة للتحقق \ (فترة المُدقّق التي تحتوي على جدول القائد لـ\).

يجب أن يُحاول المُدقّقون (validators) إرسال الطلبات المعزولة (orphan requests) إلى المُدقّقين الذين وضعوا علامة على هذا اليتيم (orphan) على أنه مُكتمل في فترة الفُتحات (EpochSlots). إذا لم تكن مثل هذه المُدقّقات (validators) موجودة، فإختر مُدققًا عشوائيًا بطريقة المُرجحة بالحِصَّة (stake-weighted).

## بروتوكول إستجابة الإصلاح (Repair Response Protocol)

عندما يتلقى المُدقّق (validator) طلبًا للحصول على أشلاء `S`، يستجيبون بالأشلاء إذا كان لديهم.

عندما يستقبل المُدقّق (validator) شضية (Shred) من خلال إستجابة إصلاح، يقوم بفحص `EpochSlots` لمعرفة ما إذا كانت <= `1/3` من الشبكة قد حددت هذه الفُتحة (Slot) على أنها مُكتملة. إذا كان الأمر كذلك، فإنهم يُعيدون تقديم هذه الشظية من خلال مسار التوربين (turbin) المُرتبط به، ولكن فقط إذا لم يقم هذا المُدقق بإعادة إرسال هذه الشضية من قبل.
