---
title: إرسال التصويت الموثوق به (Reliable Vote Transmission)
---

أصوات المُدقّق (validator) هي الرسائل التي لها وظيفة حاسمة للإجماع (consensus) والتشغيل المُستمر للشبكة. لذلك، من الأهمية بمكان أن يتم تسليمها وترميزها في دفتر الأستاذ (ledger) بصورة موثوقة.

## التحديات (Challenges)

1. يتم تشغيل تبادل أدوار القائد (Leader) بواسطة PoH، وهي ساعة ذات إنجراف عالٍ. من المُحتمل أن يكون للعديد من العُقد (nodes) عرض غير صحيح إذا كان القائد التالي نشطًا في الوقت الفعلي أم لا.
2. قد يكون من السهل إغراق القائد التالي. بالتالي فإن هجمات الشبكة المُوزعة (DDOS) لن يمنع فقط تسليم المُعاملات المُنتظمة، ولكن أيضًا رسائل الإجماع (consensus messages).
3. الـ UDP غير موثوق به، ويتطلب بروتوكولنا غير المُتزامن إعادة إرسال أي رسالة يتم إرسالها حتى يتم مُلاحظتها في دفتر الأستاذ (ledger). يُمكن أن تتسبب إعادة الإرسال في حدوث _thundering herd_ غير مقصود ضد القائد الذي يحتوي على عدد كبير من المُدقّقين (validators). أسوأ حالة إغراق ستكون `(num_nodes * num_retransmits)`.
4. لا يضمن تتبع ما إذا كان التصويت قد تم نقله أم لا عبر دفتر الأستاذ (ledger) أنه سيظهر في كتلة block مؤكدة. قد تكون الكتلة (block) المرصودة الحالية غير مُنضبطة. سيحتاج المُدقّقين (validators) إلى الحفاظ على الحالة لكل صوت وإنقسام أو شوكة (fork).

## التصميم (Design)

1. إرسال الأصوات كرسالة دفع من خلال القيل والقال (gossip). هذا يضمن تسليم التصويت إلى جميع القادة (leaders) المُقبلين، وليس القادة المُستقبليين فقط.
2. سيقرأ القادة جدول Crds للحصول على أصوات جديدة وترميز أي أصوات جديدة تم إستلامها في الكتل (blocks) التي يقترحونها. يسمح هذا بإدراج أصوات المُدقّقين (validators) في الإنقسامات أو الشوكات (forks) بالتراجع من قبل جميع قادة المستقبل.
3. سيقوم لمُدقّقون (validators) الذين يتلقون الأصوات في دفتر الأستاذ (ledger) بإضافتهم إلى جدول المجموعات المحلي الخاص بهم، ليس كطلب دفع، ولكن ببساطة يُضيفهم إلى الجدول. يقوم هذا بإختصار بروتوكول رسائل الدفع، لذلك لا تحتاج رسائل المُصادقة (validation) إلى إعادة الإرسال مرتين حول الشبكة.
4. يجب أن تبدو CrdsValue للتصويت هكذا `Votes(Vec<Transaction>)`

يجب أن تحتفظ كل مُعاملة تصويت بساعة حائط `wallclock` في بياناتها. ستحتفظ إستراتيجية الدمج الخاصة بالأصوات بآخر N مجموعة من الأصوات كما تم تكوينها بواسطة العميل المحلي. بالنسبة للدفع / السحب، يتم إجتياز الناقل (vector) بشكل مُتكرر ويتم التعامل مع كل مُعاملة على أنها قيمة CrdsValue فردية مع ساعة الحائط (wallclock) والتوقيع المحلي الخاصين بها.

تم تصميم القيل والقال (gossip) لنشر كفاءة الحالة. يتم تجميع الرسائل التي يتم إرسالها من خلال دفع القيل والقال (gossip-push) ونشرها مع الحد الأدنى من الشجرة المُمتدة لبقية الشبكة. يتم إصلاح أي فشل جزئي في الشجرة بشكل فعال بإستخدام بروتوكول سحب القيل والقال (gossip-pull protocol) مع تقليل كمية البيانات المنقولة بين أي عُقد (nodes).

## كيف يحل هذا التصميم التحديات (How this design solves the Challenges)

1. نظرًا لعدم وجود طريقة سهلة للمُدقّقين (validators) ليكونوا مُتزامنين مع القادة (leader) في حالة القائد "النشط" ، فإن القيل والقال (gossip) يسمح بالتسليم النهائي بغض النظر عن تلك الحالة.
2. سوف تقوم القيل والقال (gossip) بتسليم الرسائل إلى جميع القادة اللاحقين، لذلك إذا تم إغراق القائد الحالي، فسيكون الزعيم التالي قد حصل بالفعل على هذه الأصوات وسيكون قادرًا على تشفيرها.
3. تقلل القيل والقال (gossip) عدد الطلبات عبر الشبكة عن طريق الحفاظ على شجرة مُمتدة فعالة، وإستخدام مُرشحات bloom لإصلاح الحالة. لذا فإن إعادة إرسال التراجع ليس ضروريًا ويتم تجميع الرسائل.
4. سيقوم القادة الذين يقرؤون جدول crds للأصوات بترميز جميع الأصوات الصالحة الجديدة التي تظهر في الجدول. حتى إذا كانت كتلة (block) هذا القائد غير مُقيدة، سيحاول القائد التالي إضافة نفس الأصوات دون أي عمل إضافي يقوم به المُدقّق (validator). بالتالي ليس فقط ضمان التسليم في نهاية المطاف، ولكن في نهاية المطاف الترميز في دفتر الأستاذ (ledger).

## الأداء (Performance)

1. أسوأ وقت لإنتشار الحالة للزعيم التالي هو قفزات سجل \ (N\) مع قاعدة إعتمادًا على التوزيع. مع إنتشارنا الإفتراضي الحالي المُكون من 6، فهو يتراوح بين 6 قفزات (hops) إلى 20 ألف عُقدة (nodes).
2. يجب أن يتلقى القائد 20 ألفًا من أصوات المُصادقة (validation) المُجمعة عن طريق دفع القيل والقال (gossip-push) في أشلاء بحجم MTU. مما يُقلل عدد الحِزم (packets) لشبكة 20 ألفًا إلى 80 قطعة.
3. يتم تكرار تصويت كل مُدقّق (validators) عبر الشبكة بالكامل. للحفاظ على قائمة إنتظار مُكونة من 5 أصوات سابقة، سيزداد جدول Crds بمقدار 25 megabytes. `(20,000 nodes * 256 bytes * 5)`.

## طرح التنفيذ على خطوتين (Two step implementation rollout)

يُمكن مبدئيًا للشبكة أن تعمل بشكل موثوق بمجرد نقل صوت واحد والحفاظ عليه من خلال الشبكة مع تنفيذ التصويت الحالي. بالنسبة للشبكات الصغيرة، يكفي عدد 6 توزيعات. مع الشبكة الصغيرة، تكون الذاكرة والدفع العلوي طفيفًا.

### شبكة مُدقّق (validator) بعدد أقل من 1000

1. تحتفظ الـ Crds بالتصويت الأخير فقط للمُدقّقين (validators).
2. يتم دفع الأصوات وإعادة إرسالها بغض النظر عما إذا كانت تظهر في دفتر الأستاذ (ledger).
3. توزيع (Fanout) من 6.
4. أسوأ حالة سعة ذاكرة 256 كيلو بايت لكل عُقدة (node).
5. أسوأ حالة عدد 4 قفزات (hops) للإنتشار إلى كل عُقدة (node).
6. يجب أن يتلقى القائد مجموعة تصويت المُدقّق (validator) بالكامل في عدد 4 قطع من رسائل الدفع.

### شبكة بعدد أقل من 20 ألف

كل ما ورد أعلاه بالإضافة إلى ما يلي:

1. يحتفظ جدول CRDS بناقلات من 5 أحدث أصوات المُصادقة.
2. تقوم الأصوات بترميز ساعة حائط (wallclock). CrdsValue::Votes هو نوع يتكرر في ناقل المُعاملات لجميع بروتوكولات القيل والقال (gossip).
3. زيادة التوزيع (Fanout) إلى 20.
4. أسوأ حالة سعة ذاكرة 25mb لكل عُقدة (node).
5. الأسوأ هي أقل من عدد 4 قفزات (hops) لتقديمها إلى الشبكة بالكامل.
6. تلقى القائد 80 شظية لجميع رسائل المُدقّق (validator).
