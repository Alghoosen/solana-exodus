---
title: التحقق من اللقطة (Snapshot Verification)
---

## المُشكل (Problem)

عندما يقوم المُدقّق (validator) بالتمهيد من لقطة، فإنه يحتاج إلى طريقة للتحقق من أن مجموعة الحساب تتطابق مع ما تراه بقية الشبكة بسرعة. يُمكن للمهاجم المُحتمل أن يُعطي المُدقّق (validator) حالة غير صحيحة، ثم يُحاول إقناعه بقبول مُعاملة قد يتم رفضها بخلاف ذلك.

## الحل (Solution)

يتم حاليًا إشتقاق تجزئة البنك (bank hash) من تجزئة حالة delta للحسابات في فُتحة (Slot) يتم دمجها بعد ذلك مع قيمة تجزئة البنك السابقة. تكمن المُشكلة في ذلك في أن قائمة التجزئة ستزداد بترتيب عدد الفُتحات (Slots) التي تتم مُعالجتها بواسطة الشبكة وتصبح عبئًا على كل من عمليتي الإرسال والتحقق بنجاح.

يمكن أن تكون الطريقة الساذجة الأخرى هي إنشاء شجرة Merkle لحالة الحساب. هذا له جانب سلبي أنه مع كل تحديث للحساب، يجب إعادة حساب شجرة Merkle من حالة الحساب بالكامل لجميع الحسابات النشطة أو الشغالة في النظام.

للتحقق من اللقطة (snapshot)، نقوم بما يلي:

في مخزن الحساب الخاص بحسابات الـ lamport غير الصفرية، نقوم بتجزئة (hash) البيانات التالية:

- مالك الحساب (Account owner)
- بيانات الحساب (Account data)
- حساب المفتاح العمومي (Account pubkey)
- رصيد الـ lamports في الحساب (Account lamports balance)
- الإنقسام أو الشوكة (fork) المُخزن عليها الحساب (Fork the account is stored on)

إستخدم قيمة التجزئة (hash) الناتجة هذه كمدخل لوظيفة التوسيع التي تُوسع قيمة التجزئة إلى قيمة الصورة. ستُنشئ الوظيفة كتلة (block) بحجم 440 byte من البيانات حيث تكون أول 32 byte هي قيمة التجزئة، ويتم إنشاء 440-32 byte التالية من Chacha RNG مع التجزئة على أنها البذور (seed).

ثم يتم دمج صور الحساب مع xor. سيتم عمل xor لقيمة الحساب السابقة في الحالة وقيمة الحساب الجديد أيضًا في الحالة.

تحدث قيم التصويت وتجزئة sysvar مع تجزئة قيمة الصورة الكاملة الناتجة.

عند تشغيل المُدقّق (validator)، عندما يتم تحميلها من لقطة، فإنها تتحقق من قيمة التجزئة مع مجموعة الحسابات. سيستخدم بعد ذلك SPV لعرض النسبة المئوية للشبكة التي صوتت لقيمة التجزئة المُعطاة.

يمكن التحقق من القيمة الناتجة بواسطة المُدقّق (validator) لتكون نتيجة لعملية الـ xor لجميع حالات الحساب الجاري معًا.

يجب أن تكون اللقطة (snapshot) خالية من حسابات الـ lamport الصفرية قبل الإنشاء وأثناء التحقق نظرًا لأن حسابات حسابات الـ lamport الصفرية لا تُؤثر على قيمة التجزئة ولكنها قد تتسبب في أن يقرأ بنك التدقيق (validator bank) أن الحساب غير موجود في الوقت الذي يجب أن يكون فيه بالفعل.

يمكن إجراء هجوم على حالة الـ xor للتأثير على قيمتها:

بالتالي فإن حجم الصورة 440 byte يأتي من هذا الورق، مما يُؤدي إلى تجنب تصادم الـ xor مع 0 \ (أو بالتالي أي نمط بت آخر مُعين\): \[[https://link.springer.com/content/pdf/10.1007%2F3-540-45708-9_19.pdf](https://link.springer.com/content/pdf/10.1007%2F3-540-45708-9_19.pdf)\]

توفر الرياضيات أمان 128 bit في هذه الحالة:

```text
O(k * 2^(n/(1+lg(k)))
k=2^40 accounts
n=440
2^(40) * 2^(448 * 8 / 41) ~= O(2^(128))
```
