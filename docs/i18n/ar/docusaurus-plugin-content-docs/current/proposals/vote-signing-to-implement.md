---
title: التوقيع الآمن على التصويت (Secure Vote Signing)
---

## التوقيع الآمن على التصويت (Secure Vote Signing)

يصف هذا التصميم سلوك توقيع التصويت الإضافي الذي سيجعل العملية أكثر أمانًا.

تطبق Solana حاليًا خدمة توقيع التصويت التي تُقيّم كل صوت للتأكد من أنها لا تنتهك شرط الإقتطاع (slashing). يُمكن أن يكون للخدمة فروق مُختلفة، إعتمادًا على إمكانيات النظام الأساسي للأجهزة. على وجه الخصوص، يُمكن إستخدامه بالإقتران مع جيب (enclave) آمن \ (مثل SGX \). يُمكن أن يُنشئ الجَيْب (enclave) مفتاحًا غير مُتماثل، مما يعرض واجهة برمجة التطبيقات (API) لكود المُستخدم \ (غير موثوق به \) للتوقيع على مُعاملات التصويت، مع الإحتفاظ المفتاح الخاص (private key) لتوقيع التصويت في ذاكرته المحمية.

توضح الأقسام التالية كيفية عمل هذه البنية:

### تدفق الرسائل (Message Flow)

1. تُهيئ العُقدة (node) الجَيْب (enclave) عند بدء التشغيل

   - يُنشئ الجَيْب (enclave) مفتاحًا غير مُتماثل ويُعيد المفتاح المفتاح العمومي (public key) إلى

     العُقدة (node)

   - زوج المفاتيح (keypair) سريع الزوال. يتم إنشاء زوج مفاتيح (keypair) جديد عند بدأ إشتغال أو تمهيد (bootup) العُقدة (node). يُمكن أيضًا إنشاء

     زوج مفاتيح (keypair) جديد في وقت التشغيل بناءً على بعض

     المعايير التي سيتم تحديدها.

   - يُعيد الجَيْب (enclave) تقرير التَصدِيق الخاص به إلى العُقدة (node)

2. تقوم العُقدة (node) بتَصدِيق الجَيْب (Enclave) \ (على سبيل المثال، إستخدام واجهات برمجة تطبيقات الـ IAS الخاصة بشركة Intel\)

   - تضمن العُقدة (node) تشغيل جَيْب آمن (Secure Enclave) على TPM

     وتوقيعه بواسطة جهة موثوقة

3. يمنح صاحب المصلحة في العُقدة (node) إذن مفتاح مُؤَقّت (ephemeral key) لإستخدام حِصّته (stake). يجب تحديد هذه العملية.

   لا بد من تحديد هذه العملية.

4. يستدعي برنامج العُقدة (node) غير الموثوق به وغير المُحاصر (non-enclave) برنامج الجيب الموثوق به

   بإستخدام واجهته لتوقيع المُعاملات والبيانات الأخرى.

   - في حالة توقيع التصويت، تحتاج العُقدة (node) إلى التحقق من PoH. التحقق من PoH

     جزء لا يتجزأ من التوقيع. سيتم تزويد الجيب المُحاصر (enclave)

     ببعض البيانات التي يُمكن التحقق منها للتحقق قبل التوقيع على التصويت.

   - يجب تحديد عملية إنشاء البيانات التي يُمكن التحقق منها في مساحة غير موثوق بها

### التحقق من PoH

1. عندما تصوت العُقدة (node) على مُدخل `X`، فهناك فترة إغلاق `N`،

   التي لا يُمكنها التصويت على إنقسام أو شوكة (Fork) لا تحتوي على `X` في سجلها.

2. في كل مرة تصوت العُقدة (node) على مُشتق `X`، لنقل `X+y`، فترة الإغلاق

   تزداد لـ `X` بمُعامل `F` \ (أي أن مدة العُقدة لا يُمكنها التصويت على

   إنقسام أو شوكة (fork) لا تحتوي على زيادات `X` \).

   - فترة الإغلاق لـ `X+y` لا تزال `N` حتى تُصوت العُقدة مرة أخرى.

3. تم تحديد زيادة فترة الإغلاق \ (على سبيل المثال، ينطبق العامل `F` بحد أقصى 32

   مرة \).

4. يجب ألا يُوقع الجيب المُحاصر (enclave) على تصويت ينتهك هذه السياسة. هذا

   يعنى

   - تمت تهيئة الجيب المُحاصر (enclave) بـ `N` و `F` و `Factor cap`
   - مخازن الجيب المُحاصر (enclave) بحد أقصى `Factor cap` رقم مُعرفات الإدخال (entry ID) التي صوتت العُقدة (node)

     عليها مُسبقًا

   - يحتوي طلب التوقيع على مُعرف المُدخل (entry ID) للتصويت الجديد
   - يقوم الجيب المُحاصر (enclave) بالتحقق من أن مُعرف المُدخل (entry ID) الخاص بالتصويت الجديد على الإنقسام أو الشوكة (fork) الصحيحة

     \(إتباع القاعدتين \#1 و \#2 أعلاه\)

### التحقق من السلف المُشترك (Ancestor Verification)

هذا هو نهج بديل، وإن كان أقل تأكيدًا للتحقق من إنقسام أو شوكة التصويت (voting fork). 1. يحتفظ المُدقّق (validator) بمجموعة نشطة من العُقد (nodes) في المجموعة (cluster) عدد 2. يُراقب الأصوات من المجموعة النشطة في فترة التصويت الأخيرة 3. تُخزن السلف المُشترك / علامة (last_tick) صوتت عليها كل عُقدة 4. يُرسل طلب تصويت جديد لخدمة توقيع التصويت (vote-signing service)

- تتضمن الأصوات السابقة من العُقد (nodes) في المجموعة النشطة، و

  الأسلاف المُشتركة (ancestors) المُناسبة

  1. يتحقق المُوَقِّع (signer) مما إذا كانت الأصوات السابقة تحتوي على تصويت من المُدقّق (validator)،

     ويتطابق تصويت السلف (ancestor) مع غالبية العُقد (nodes)

- يُوقع على التصويت الجديد إذا كان التحقق ناجحًا
- يُؤكد \ (يُثير إنذارًا من نوع ما\) إذا كان التَحَقُّق غير ناجح

الفرضية هي أنه يُمكن مُخادعة المُدقّق (validator) مرة واحدة على الأكثر للتصويت على بيانات غير صحيحة. إذا قام شخص ما بإختطاف المُدقّق (validator) وإرسال طلب تصويت للحصول على بيانات زائفة، فلن يتم تضمين هذا التصويت في PoH \ (حيث سيتم رفضه من قبل المجموعة \). في المرة التالية التي يُرسل فيها المُدقّق (validator) طلبًا للتوقيع على التصويت، ستكتشف خدمة التوقيع أن التصويت الأخير للمُدقّق مفقود \ (كجزء من

## 5 المذكور أعلاه\).

### تحديد الإنقسام أو الشوكة (Fork determination)

نظرًا لحقيقة أن الجيب المُحاصر (enclave) لا يُمكنه مُعالجة PoH، لإنه ليس لديه معرفة مُباشرة بتاريخ الإنقسام أو الشوكة (fork) لتصويت المُدقّق (validator) المُقدم. يجب أن يبدأ كل جيب المُحاصر (enclave) بالمجموعة النَشِطة _active set_ الحالية من المفاتيح العمومية (public keys). يجب على المُدقّق (validator) إرسال تصويته الحالي جنبًا إلى جنب مع أصوات المجموعة النشطة \ (بما في ذلك نفسها \) التي لاحظها في فُتحة (Slot) التصويت السابقة. بهذه الطريقة، يُمكن للجيب المُحاصر (enclave) أن يُخمن الأصوات المُصاحبة للتصويت السابق للمُدقّق (validator) وبالتالي يتم التصويت على الإنقسام أو الشوكة (fork). هذا غير مُمكن للتصويت الأولي المُقدم من المُدقّق (validator)، حيث لن يحتوي على فُتحة (Slot) "سابقة" للرجوع إليها. لحساب ذلك، يجب تطبيق تجميد قصير للتصويت حتى يتم إرسال التصويت الثاني الذي يحتوي على الأصوات داخل المجموعة النشطة، إلى جانب التصويت الخاص به، في ذروة التصويت الأولي.

### إعدادات الجيب المُحاصر (Enclave configuration)

يجب أن يكون عميل إثبات الحِصَّة أو التَّحْصِيص (staking client) قابلاً للإعداد لمنع التصويت على إنقسامات أو شوكات (forks) غير نشطة. يجب أن تستخدم هذه الآلية المجموعة النشطة المعروفة للعميل `N_active` جنبًا إلى جنب مع الحد الأدنى للتصويت `N_vote` وعمق الحد الأدنى `N_depth` لتحديد ما إذا كنت ستستمر في التصويت على الإنقسام أو الشوكة (fork) المُقدم أم لا. يجب أن يأخذ هذا الإعداد شكل قاعدة بحيث يُصوت العميل (client) فقط على إنقسام أو شوكة (fork) إذا لاحظ أكثر من `N_vote` عند `N_depth`. عمليًا، هذا يُمثل العميل (client) من التأكيد على أنه قد لاحظ بعض الإحتمالات الإقتصادية النهائية للإنقسام أو الشوكة (fork) المُقدمة على عمق حيث سيُؤدي التصويت الإضافي إلى إغلاق لفترة غير مرغوب فيها من الوقت إذا تبين أن هذا الإنقسام أو الشوكة (fork) ليست شغالة.

### التحديات (Challenges)

1. توليد بيانات يُمكن التحقق منها في مساحة غير موثوق بها للتحقق من PoH في

   الجَيْب المُحاصر (enclave).

2. بحاجة إلى بنية تحتية لمنح حِصَّة (stake) لمفتاح مُؤَقّت (ephemeral key).
