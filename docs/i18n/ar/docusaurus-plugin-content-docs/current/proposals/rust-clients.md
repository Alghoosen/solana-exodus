---
title: عملاء Rust أو Rust Clients
---

## المُشكل (Problem)

الإختبارات عالية المُستوى، مثل النقاط المرجعية المعيارية لعدد المُعاملات في الثانية الواحدة (bench-tps,)، مكتوبة من حيث سِمة `Client`. عندما نُنفذ هذه الإختبارات كجزء من مجموعة الإختبار، فإننا نستخدم التنفيذ المُنخفض المُستوى لعميل البنك `BankClient`. عندما نحتاج إلى إجراء نفس الإختبار على مجموعة (cluster)، فإننا نستخدم تطبيق `ThinClient`. تكمن مُشكلة هذا النهج في أنه يعني أن السِّمة (trait) ستتوسع بإستمرار لتشمل وظائف الأداة المُساعدة الجديدة وكل تطبيقاتها تحتاج إلى إضافة الوظيفة الجديدة. من خلال فصل الكائن الذي يُواجه المُستخدم عن السِّمة (trait) التي تُجرد واجهة الشبكة، يُمكننا توسيع الكائن الذي يُواجه المُستخدم ليشمل جميع أنواع الوظائف المُفيدة، مثل "spinner" من RpcClient، دون القلق من الحاجة إلى تمديد السِّمة و تطبيقاتها.

## الحل المُقترح (Proposed Solution)

بدلاً من تنفيذ سِمة (trait) العميل `Client`، يجب إنشاء عميل رفيع `ThinClient` مع تنفيذها. بهذه الطريقة، يُمكن أن تنتقل جميع وظائف الأداة الموجودة حاليًا في سِمة العميل`Client` إلى العميل الرفيع `ThinClient`. يُمكن أن ينتقلالعميل الرفيع `ThinClient` بعد ذلك إلى `solana-sdk` نظرًا لأن جميع تبعيات الشبكة الخاصة به ستكون في تنفيذ العميل `Client`. سنُضيف بعد ذلك تطبيقًا جديدًا للعميل `Client`، يُسمى عميل المجموعة `ClusterClient`، والذي سيعيش في صندوق `solana-client`، حيث يُوجد العميل الرفيع `ThinClient` حاليًا.

بعد إعادة الترتيب هذه، سيتم كتابة أي كود يحتاج إلى عميل (client) من حيث العميل الرفيع `ThinClient`. في إختبارات الوحدة، سيتم إستدعاء الوظيفة بالعميل الرفيع `ThinClient<BankClient>`، في حين أن الوظيفة الأساسية `main()` ومعايير وإختبارات التكامل ستستدعيها بالعميل الرفيع `ThinClient<ClusterClient>`.

إذا كانت المُكونات ذات المستوى الأعلى تتطلب وظائف أكثر مما يُمكن تنفيذه بواسطة عميل البنك `BankClient`، فيجب تنفيذها بواسطة كائن ثانٍ يقوم بتنفيذ سِمة (trait) ثانية، بإتباع نفس النمط المُوضح هنا.

### مُعالجة الأخطاء (Error Handling)

يجب أن يستخدم العميل `Client` تعداد الخطأ أثناء النقل `TransportError` الحالي للأخطاء، بإستثناء أنه يجب تغيير الحقل `Custom(String)` إلى `Custom(Box<dyn Error>)`.

### إستراتيجية التنفيذ (Implementation Strategy)

1. أضف كائنًا جديدًا إلى `solana-sdk` ، `RpcClientTng`، حيث تكون اللاحقة `RpcClientTng` مُؤقتة وتدل على "الجيل التالي" اللاحق
2. قم بتهيئة `RpcClientTng` بتنفيذ `SyncClient`.
3. قُم بإضافة كائن جديد إلى `solana-sdk`، `ThinClientTng`؛ قُم بتهيئته مع تنفيذ `RpcClientTng` و `AsyncClient`
4. أُنقل جميع إختبارات الوحدة من عميل البنك `BankClient` إلى `ThinClientTng<BankClient>`
5. قُم بإضافة عميل المجموعة `ClusterClient`
6. قُم بنقل مُستخدميُ العميل الرفيع `ThinClient` إلى `ThinClientTng<ClusterClient>`
7. قُم بحذف العميل الرفيع `ThinClient` وأعد تسمية `ThinClientTng` إلى عميل رفيع `ThinClient`
8. قُم بنقل مُستخدميُ `RpcClient` إلى `ThinClient<ClusterClient>` جديد
9. قُم بحذف `RpcClient` وأعد تسمية `RpcClientTng` إلى `RpcClient`
