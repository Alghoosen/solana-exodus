# زمن إنتقال مُنخفض، RPC مُوجه نحو المُعاملات أو RiP Curl: low-latency, transaction-oriented RPC

## المُشكل

تم إنشاء تطبيق RPC الأولي الخاص بـ Solana بغرض السماح للمُستخدمين بتأكيد المُعاملات التي تم إرسالها مؤخرًا إلى المجموعة (cluster). تم تصميمه مع وضع إستخدام الذاكرة في الإعتبار بحيث يكون أي مُدقّق (validator) قادرًا على دعم واجهة برمجة التطبيقات (API) دون القلق من هجمات DoS.

في وقت لاحق، أصبح من المرغوب فيه إستخدام نفس واجهة برمجة التطبيقات (API) لدعم مُستكشف Solana. لم يدعم التصميم الأصلي سوى دقائق من السجل، لذلك قُمنا بتغييره إلى تخزين حالات المُعاملات بدلاً من ذلك في مثيل RocksDB محلي وعرض أيام من السجل. ثم قُمنا بتمديد ذلك إلى 6 أشهر عبر BigTable.

مع كل تعديل، أصبحت واجهة برمجة التطبيقات (API) أكثر مُلاءمة للتطبيقات التي تُقدم مُحتوى ثابتًا وأقل جاذبية لمُعالجة المُعاملات. يقوم العملاء بإستطلاع حالة المُعاملة بدلاً من إخطارهم، مما يعطي إنطباعًا خاطئًا عن أوقات تأكيد أعلى. علاوة على ذلك، ما يُمكن للعملاء الإقتراع من أجله محدود، مما يمنعهم من إتخاذ قرارات معقولة في الوقت الفعلي، مثل تأكيد الإعتراف بمُعاملة ما بمجرد تصويت المُدقّقين (validators) المُعتمدين عليها.

## الحل المُقترح (Proposed Solution)

واجهة برمجة تطبيقات متدفقة صديقة للويب ومُوجهة للمُعاملات ومبنية حول ReplayStage الخاص بالمُدقّق (validator).

تحسين تجربة العميل:

* دعم الإتصالات مُباشرة من تطبيقات WebAssembly.
* يُمكن إخطار العملاء بتقدم التأكيد في الوقت الفعلي، بما في ذلك الأصوات ووزن حِصَّة الناخب (voter stake).
* يُمكن إخطار العملاء عند حدوث تغيير كبير في الإنقسام، إذا كان ذلك يُؤثر على عدد تأكيد المُعاملات.

أسهل للدعم من قِبل المُدقّقين (validators):

* يدعم كل مُدقّق (validator) عددًا من الإتصالات المُتزامنة وليس له أي قيود مُهمة على الموارد.
* لا يتم تخزين حالة المُعاملة مُطلقًا في الذاكرة ولا يُمكن الإستفتاء عنها.
* يتم تخزين التوقيعات فقط في الذاكرة حتى مُستوى الإلتزام المطلوب أو حتى إنتهاء صلاحية تجزئة الكتلة (Blockhash)، وهو ما يحدث لاحقًا.

كيف تعمل:

1. يتصل العميل بالمُدقّق (validator) بإستخدام قناة إتصال موثوقة، مثل مِقبس الويب (web socket).
2. يقوم المُدقّق (validator) بتسجيل التوقيع في مرحلة ReplayStage.
3. يُرسل المُدقّق (validator) المُعاملة إلى Gulf Stream ويعيد مُحاولة جميع الإنقسامات أو الشوكات (forks) المعروفة حتى إنتهاء صلاحية تجزئة الكتلة (Blockhash) (ليس قبل أن يتم قبول المُعاملة على الإنقسام أو الشوكة الأثقل فقط). في حالة إنتهاء صلاحية تجزئة الكتلة (Blockhash)، يكون التوقيع غير مُسجل، ويتم إخطار العميل، ويتم إغلاق الإتصال.
4. نظرًا لأن ReplayStage يكتشف الأحداث التي تُؤثر على حالة المُعاملة، فإنه يقوم بذلك بإخطار العميل في الوقت الفعلي.
5. بعد التأكيد على أن المُعاملة مُتجذرة (` CommitmentLevel::Max `)، لا يتم تسجيل التوقيع ويغلق الخادم القناة الرئيسية.
