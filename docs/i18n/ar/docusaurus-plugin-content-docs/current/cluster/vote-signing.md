---
title: التوقيع الآمن على التصويت (Secure Vote Signing)
---

يستلم المُدقّق (validator) جميع المُدخلات (entries) من القائد (leader) ويُقدم أصواتا تُؤكد صِّحَّة تلك المُدخلات (entries). يُشكل هذا التصويت تحديا أمنيا، لأن الأصوات المزورة التي تنتهك قواعد الإجماع (consensus) يُمكن أن تُستخدم للإقتطاع (slash) من حِصَّة (stake) المُدقّق (validator).

يصوت المُدقّق (validator) على الإنقسام أو الشوكة (fork) المُختارة بتقديم مُعاملة تستخدم مفتاح غير مُتماثل (asymmetric key) لتوقيع نتيجة عمل التَحَقُّق من صحتها. يمكن لكيانات أخرى التحقق من هذا التوقيع بإستخدام المفتاح العمومي (public key) للمُدقّق (validator). إذا تم إستخدام مفتاح المُدقّق (validator) لتوقيع بيانات غير صحيحة \(على سبيل المثال التصويت على عدة إنقسامات أو شوكات (forks) في دفتر الأستاذ (ledger)، أو حِصَّة (stake) العُقدة (node) أو مواردها يُمكن أن تتعرض للخطر.

تُعالج Solana هذا الخطر بتقسيم خدمة المُوَقِّع على التصويت _vote signer_ لتقييم كل تصويت للتأكد من أنه لا ينتهك شرط الإقتطاع (slashing).

## المُدقّقون (Validators)، الموقِّعون على التصويت (Vote Signers) وحاملوا الحِصَّة (Stakeholders)

عندما يتلقى مُدقّق (validator) كتل (blocks) مُتعددة لنفس الفُتحة (slot)، فإنه يتتبع جميع الإنقسامات أو الشوكات (forks) المُمكنة حتى يتمكن من تحديد "أفضلها". يقوم المُدقّق (validator) بإختيار أفضل إنقسام أو شوكة (fork) وذلك بإرسال تصويت إليها، مُستخدما مُوَقِّع تصويت (vote signer) لتقليل إمكانية تصويته عن غير قصد بإنتهاك قاعدة الإجماع (consensus) والإقتطا من الحِصَّة (stake).

يقوم المُوَقِّع على التصويت (vote signer) بتقييم التصويت الذي إقترحه المُدقّق (validator) عليه ولا يُوَقِّع على التصويت إلا إذا كان ذلك لا ينتهك شرط الإقتطاع (slashing). لا يحتاج المُوَقِّع على التصويت (vote signer) إلا إلى الحفاظ على الحد الأدنى من حالة الأصوات التي وَقّع عليها والتصويت الذي وقَّعته بقية المجموعة (cluster). لا يحتاج إلى مُعالجة مجموعة كاملة من المُعاملات.

حامل الحِصَّة (Stakeholder) هي هوية تتحكم في رأس المال الذي يتم إثبات الحِصَّة عليه أو تحْصِيصه (staked capital). يمكن لحامل الحِصَّة (Stakeholder) أن يُفَوِّض حِصَّته (stake) إلى المُوَقِّع على التصويت (vote signer). وبمجرد تفويض حِصَّة (stake) ما، تمثل أصوات المُوَقِّع على التصويت (vote signer) وزن التصويت لجميع الحِصص (stakes) المُفوضة، وتُنتج مُكافآت (rewards) لجميع الحِصص (stakes) المُفَوَّضَة.

هناك حاليا علاقة 1:1 بين المُدقّقين (validators) ومُوَقِّعي الأصوات (vote signers)، ويُفَوِّض حاملوا الحِصَّة (Stakeholders) كامل حِصّتهم (stake) إلى مُوَقِّع صوت (vote signer) واحد.

## خدمة التَّوقيع (Signing service)

تتألف خدمة التَّوقيع على التصويت (vote signing service) من خادم JSON RPC ومُعالج الطلبات (request processor). عند بدء التشغيل، تشغل الخدمة خادم RPC في منفذ مُعَد (configured port) وتنتظر طلبات المُدقّق. وهي تتوقع النوع التالي من الطلبات:

1. تسجيل عُقدة تدقيق (valdiator node) جديدة

   - يجب أن يحتوي الطلب على هوية المُدقّق (validator) أي المفتاح العمومي \(public key\)
   - يجب توقيع الطلب بإستخدام المفتاح الخاص (private key) للمُدقّق (validator)
   - تُسقط الخدمة الطلب إذا تعذّر التحقق من توقيع الطلب
   - الخدمة تخلق مفتاح تصويت غير متماثل (voting asymmetric key) جديد للمُدقّق (validator)، وتُعيد المفتاح العمومي (public key) كرد
   - إذا حاول أحد المُدقّقين (validator) التسجيل مرة أخرى، تُرجع الخدمة المفتاح العمومي (public key) من أزواج المفاتيح (keypair) الموجودة من قبل

2. توقيع التصويت (Sign a vote)

   - يجب أن يحتوي الطلب على مُعاملة تصويت (voting transaction) وجميع بيانات التَحَقُّق
   - يجب توقيع الطلب بإستخدام المفتاح الخاص (private key) للمُدقّق (validator)
   - تُسقط الخدمة الطلب إذا تعذّر التحقق من توقيع الطلب
   - تتحقق الخدمة من بيانات التصويت ( voting data)
   - تقوم الخدمة بإرجاع توقيع للمُعاملة

## تصويت المُدقّق (validator voting)

عند بدء التشغيل تُنشئ عُقد التدقيق (validator nodes) حساب تصويت (vote account) جديد وتُسجله مع المجموعة (cluster) عن طريق تقديم مُعاملة "سجل تصويت" (vote register) جديدة. العُقَد (nodes) الأخرى في المجموعة تُعالج هذه المُعاملة وتتضمن المُدقّق (validator) الجديد في المجموعة النشطة. يُقدم المُدقّق (validator) في وقت لاحق مُعاملة "تصويت جديد" (new vote) ةوقعة بالمفتاح الخاص (private key) بالتصويت للمُدقّق (validator) على كل حدث تصويتي.

### الإعدادات (Configuration)

تم إعداد عُقَد التدقيق (validator nodes) مع نقطة نهاية شبكة خدمة التوقيع \(IP/Port\).

### التسجيل (Registration)

عند بدء التشغيل، يسجل المُدقّق (validator) نفسه بخدمة التوقيع بإستخدام JSON RPC. تُرجع مُكالمة RPC المفتاح العام للتصويت (voting public key) لعُقدة التدقيق (valdiator node). يقوم المُدقّق (validator) بإنشاء مُعاملة "سجل تصويت" (vote register) جديدة تتضمن المفتاح العمومي (public key)، ويُقدمها إلى المجموعة (cluster).

### تجميع الأصوات (Vote Collection)

يبحث المُدقّق (validator) عن الأصوات المُقدمة من جميع العُقد (nodes) في المجموعة (cluster) لفترة التصويت الأخيرة. تُقدَّم هذه المعلومات إلى دائرة التوقيع (signing service) مع طلب جديد للتوقيع على التصويت.

### توقيع تصويت جديد (New Vote Signing)

يقوم المُدقّق (validator) بإنشاء مُعاملة "تصويت جديد" (new vote) وإرسالها إلى خدمة التوقيع (signing service) بإستخدام JSON RPC. كما يشمل طلب الRPC بيانات التحقق من التصويت. عند النجاح، يدعو الRPC إلى إعادة التوقيع لعرضه على التصويت. عند الفشل، يُرجاع الRPC رمز الفشل.
