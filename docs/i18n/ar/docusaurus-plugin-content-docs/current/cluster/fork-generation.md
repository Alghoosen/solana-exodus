---
title: توليد الإنقسام أو الشوكة (Fork Generation)
---

يصف هذا القسم كيفية حدوث توليد الإنقسام أو الشوكة (fork) بشكل طبيعي كنتيجة لتناوب القائد [leader rotation](leader-rotation.md).

## نظرة عامة

تأخذ العُقَد (nodes) دور القائد (leader) وتولد الـ PoH الذي يُشفر تغييرات الحالة. يُمكن للمجموعة (cluster) تحمل فقدان الإتصال بأي قائد (leader) عن طريق تجميع ما كان من المُمكن للقائد _****_ أن يُولده لو كان مُتصلا لكنه لم يقم بتغيير أي حالة. إن العدد المحتمل من الشوكات أو الForks يقتصر على قائمة تخطي "there/not-there" من الشوكات التي قد تنشأ على حدود فتحة تناوب الleader. وفي أي فُتحة (slot) مُعينة، لا تقبل سوى مُعاملات قائد (leader) واحد.

## تدفق الرسائل (Message Flow)

1. يتم إستيعاب المُعاملات من قبل القائد (leader) الحالي.
2. يقوم القائد (leader) بتصفية المُعاملات الصالحة.
3. يقوم القائد (leader) بتنفيذ مُعاملات صالحة لتحديث حالته.
4. يقوم القائد (leader) بحزم المُعاملات في المُدخلات (entries) بناء على فُتحة الـ PoH الحالية.
5. يقوم القائد (leader) بنقل المواد إلى عُقَد المُدقّقين (validator nodes) \(في شضايا مُوقَّعة\)
   1. يشمل تيار PoH كل العلامات (ticks)؛ المُدخلات (inputs) الفارغة التي تُشير إلى وجود القائد (leader) ومرور الوقت على المجموعة (cluster).
   2. يبدأ تيار القائد (leader) بمُدخلات (inputs) العلامة (tick) الضرورية لإكمال الـ PoH مرة أخرى إلى آخر فُتحة (Slot) سابقة للقائد (leader).
6. يُعيد المُدقّقون (validators) إرسال المُدخلات (entries) إلى أقرانهم في مجموعتهم وإلى المزيد من العُقَد (nodes) الأخرى.
7. يتحقق المُدقّقون (validators) من صحة المُعاملات وتنفيذها في حالاتهم (state).
8. يقوم المُدقّقون (validators) بحساب التجزئة (hash) للحالة (state).
9. في أوقات محددة، أي عدد مُحدد من كل علامة (tick) الخاصة بالـ PoH، يقوم المُدقّقون (validators) بإحالة الأصوات إلى القائد.
   1. الأصوات هي توقيعات لتجزئة (hash) الحالة المُحَوْسَبَة عند العلامة (tick) الخاصة بالـ PoH هذا.
   2. يتم نشر الأصوات (votes) عن طريق نظام القيل والقال (gossip).
10. يقوم القائد (leader) بتنفيذ الأصوات، مثل أي مُعاملة أخرى، ويبثها إلى المجموعة (cluster).
11. يُراقب المُدقّقون (validators) الأصوات (votes) وجميع الأصوات من المجموعة (cluster).

## التقسيمات (Partitions)، الإنقسامات أو الشوكات (forks)

يمكن أن تنشأ الإنقسامات أو الشوكات (forks) عند العلامة (tick) الخاصة بالـ PoH المُقابلة لصوت ما. قد لا يكون القائد (leader) التالي قد راقب آخر فُتحة (Slot) تصويت، وقد يبدأ تشغيل فُتحته بمُدخلات (entries) الـ PoH الإفتراضية التي تم إنشاؤها. يتم توليد هذه العلامات (ticks) الفارغة بواسطة جميع العُقَد (nodes) في الفُتحة (Slot) بمُعدل تجزئات (hashes) الفُتحة المُهيئة (cluster-configured) `Z`.

هناك إصدران مُحتملان فقط من PoH خلال فُتحة (Slot) التصويت: PoH مع `T` العلامة (tick) الخاصة به ومُدخلات (inputs) تم إنشاؤها من قبل القائد (leader) الحالي، أو PoH مع العلامة (tick) الخاصة به فقط. النسخة "ticks فقط (just ticks)" من إثبات التاريخ PoH يُمكن إعتبارها دفتر أستاذ (ledger) إفتراضي، الذي يُمكن أن تستمد منه كل العُقَد (nodes) في المجموعة (cluster) آخر وقت أو علامة (tick) في الفُتحة (Slot) السابقة.

يُمكن للمُدقّقين (validators) تجاهل الإنقسامات أو الشوكات (forks) في نقاط أخرى \(على سبيل المثال من القائد الخاطئ\)، أو تخفيض القائد (leader) المسؤول عن الإنقسام أو الشوكة (fork).

يصوت المُدقّقون (validators) بناء على الطمع لزيادة مُكافأتهم الموصوفة في [Tower BFTBFT](../implemented-proposals/tower-bft.md).

### وجهة نظر المُدقّق (validator)

#### التدرج الزمني

الرسم البياني أدناه يُمثل وجهة نظر المُدقّق (validator) لمجرى PoH مع إنقسامات أو شوكات (forks) مُمكنة مع مرور الوقت. L1, L2, إلخ. هي فُتحات (Slots) القائد (leader)، و `E`s تُمثل مُدخلات (entries) من ذلك القائد خلال فتحة القائد. هذا الكود `x`s يُمثل علامة (tick) واحدة فقط، والوقت يتدفق إلى أسفل في الرسم البياني.

![توليد الإنقسام أو الشوكة (Fork generation)](/img/fork-generation.svg)

لاحظ أن `E` يظهر على عدد 2 إنقسامات أو شوكات (forks) في نفس الفُتحة (Slot) قابل لشرط الإقتطاع (slashable)، إذا يُمكن للمُدقّق (validator) الذي يُراقب `E3` و `E3'` أن يقسم L3 ويختار بشكل آمن `x` لتلك الفُتحة (Slot). بمجرد أن يلتزم مُدقّق (validator) واحد بالإنقسام أو الشوكة (fork)، يُمكن التخلي عن الإنقسام أو الشوكة (fork) الأخرى أسفل عدد العلامة (tick) تلك. بالنسبة لأي فُتحة (Slot)، يجب أن ينظر المُدقّقون (validators) فقط في شبكة "لها مُدخلات (entries)" واحدة أو شبكة "علامات (ticks) فقط " ليقترحها القائد (leader). لكن العديد من المُدخلات (entries) الإفتراضية قد تتداخل مع إرتباطها بالفُتحة (Slot) السابقة.

#### التقسيم الزمني (Time Division)

من المُفيد إعتبار تناوب تناوب القائد (leader rotation) على العلامة (tick) الخاصة بالـ PoH كتقسيم لوقت العملية لترميز حالة المجموعة(cluster). يعرض الجدول التالي شجرة الإنقسامات أو الشوكات (forks) المذكورة أعلاه كدفتر أستاذ (ledger) مُقسم زمنيا.

| الفُتحة القائد (leader slot)     | L1 | L2 | L3 | L4 | L5 |
|:-------------------------------- |:-- |:-- |:-- |:-- |:-- |
| البيانات                         | E1 | E2 | E3 | E4 | E5 |
| العلامة (tick) من اللحظة السابقة |    |    |    | x  | xx |

لاحظ أن فقط البيانات من القائد (leader) في L3 سيتم قبولها خلال فُتحة (Slot) القائد في L3. قد تتضمن البيانات من L3 علامات (ticks) "اللحاق بالركب" إلى فُتحة (Slot) أخرى غير L2 إذا لم تُراقب L3 بيانات L2. تتضمن عمليات الإرسال في L4 و L5 مُدخلات (inputs) "العلامة (tick) من اللحظة السابقة" الخاصة بالـ PoH.

هذا الترتيب لتدفق بيانات الشبكة يسمح للعُقَد (nodes) بحفظ ذلك بالضبط في دفتر الأستاذ (ledger) لإعادة العرض، إعادة التشغيل ونقاط التَحَقُّق (checkpoints).

### وجهة نظر القائد (leader)

عندما يُشَغَّل القائد (leader) فُتحة (Slot) جديدة، يجب أن ينقل أولاً أي PoH \(ticks\) مطلوبة لربط الفُتحة الجديدة مع أحدث فُتحة تمت مُلاحظتها حديثا وتم التصويت لصالحها. الإنقسام أو الشوكة (fork) الذي يقترحه القائد (leader) يربط الفُتحة (Slot) الحالية بإنقسام أو شوكة (fork) سابقة صوت عليها القائد (leader) بعلامة (tick) إفتراضية.
