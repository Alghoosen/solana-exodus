---
title: إدارة الإنقسامات أو الشوكات (Managing Forks)
---

يسمح دفتر الأستاذ (ledger) بالإنقسامات أو الشوكات (forks) عند حدود الفُتحة (slot). بنية البيانات الناتجة تُشكل شجرة تُسمى مخزن الكُتلة _blockstore_. عندما يُفسر المُدقّق (validator) مخزن الكُتلة (blockstore)، يجب أن يُحافظ على حالة كل إنقسام أو شوكة (fork) في الشبكة. نطلق على كل حالة إسم إنقسام إنقسام أو شوكة نشطة _active fork_. تقع على عاتق المُدقّق (validator) مسؤولية تقييم وزن تلك الإنقسامات أو الشوكات (forks)، بحيث يُمكنه في النهاية إختيار الإنقسام أو الشوكة (fork).

يُحدد المُدقّق (validator) الإنقسام أو الشوكة (fork) عن طريق إرسال صوت إلى قائد (leader) الفُتحة (slot) لذلك الإنقسام أو الشوكة (fork). يُلزم الصوت المُدقّق (validator) لمدة زمنية تُسمى فترة القِفْل _lockout period_. لا يُسمح المُدقّق (validator) بالتصويت على إنقسام أو شوكة (fork) مُختلفة حتى تنتهي فترة القِفْل (lockout period) هذه. كل تصويت لاحق على نفس الإنقسام أو الشوكة (fork) يُضاعف طول فترة القِفْل (lockout period). بعد عدد بعض أصوات الفُتحة المُهيئة (cluster-configured) \(حاليا 32\)، يصل طول فترة القِفْل (lockout period) إلى ما يُسمى الحد الأقصى للقِفْل _max lockout_. حتى يتم الوصول إلى الحد الأقصى للقِفْل (max lockout)، لدى المُدقّق (validator) خيار الإنتظار حتى تنتهي فترة القِفْل (lockout period) ثم التصويت على إنقسام أو شوكة (fork) أخرى. عندما يصوت على إنقسام أو شوكة (fork) أخرى، فإنه يُنفذ عملية تسمى التراجع _rollback_، حيث تعود الحالة إلى الوراء في الوقت المُناسب إلى نقطة تَحَقُّق (checkpoint) مُشتركة ثم تقفز إلى الأمام إلى طرف الإنقسام أو الشوكة (fork) التي صوتت للتو. الحد الأقصى للمسافة التي يُمكن أن يرجع إليها الإنقسام أو الشوكة (fork) يُسمى عُمْق التراجع _rollback depth_. عُمْق التراجع (rollback depth) هو عدد الأصوات المطلوبة لتحقيق الحد الأقصى للقِفْل (max lockout). عندما يُصوت أحد المُدقّقين (validator)، تُصبح أي نقاط تَحَقُّق (checkpoints) خارج عُمْق التراجع (rollback depth) غير قابلة للوصول إليها. ذلك يعني أنه لا يوجد سيناريو يحتاج فيه المُدقّق (validator) إلى التراجع إلى ما يتجاوز عُمْق التراجع (rollback depth). لذلك يُصبح بالإمكان وبكل أمان ضغط _prune_ الإنقسامات أو الشوكات (forks) الغير قابلة للوصول إليها و _squash_ في جميع نقاط التَحَقُّق (checkpoints) التي تتجاوز عُمْق التراجع (rollback depth) إلى نقطة التَحَقُّق الجذرية (root checkpoint).

## الإنقسامات أو الشوكات النشطة (Active Forks)

الإنقسام أو الشوكة (fork) النشطة كسلسلة من نقاط التَحَقُّق (checkpoints) التي يكون طولها أطول من عُمْق التراجع (rollback depth) بمُعدل مرة واحدة على الأقل. أقصر إنقسام أو شوكة (fork) سيكون لها طول أطول بالضبط من عُمْق التراجع (rollback depth). على سبيل المثال:

![الإنقسامات أو الشوكات (forks)](/img/forks.svg)

التسلسل التالي هو الإنقسامات أو الشوكات النشطة _active forks_:

- {4, 2, 1}
- {5, 2, 1}
- {6, 3, 1}
- {7, 3, 1}

## الضغط (Pruning) والسحق (Squashing)

يُمكن للمُدقّق (validator) أن يُصوت على أي نقطة تَحَقُّق (checkpoint) في الشجرة. في الرسم البياني أعلاه، كل عُقَدة (node) بإستثناء أوراق الشجرة. بعد التصويت، يقوم المُدقّق (valdiator) بضغط (prune) العُقَد (nodes) التي تتفرع من مسافة أبعد من عُمْق التراجع (rollback depth)، ثم ينتهز الفرصة لتقليل إستخدام الذاكرة (memory usage) عن طريق سحق (squash) أي عُقَد (nodes) يُمكنها الوصول إلى الجذر (root).

بدءا بالمثال أعلاه، مع عُمْق تراجع (rollback depth) يصل إلى 2، فكر في التصويت على 5 مُقابل التصويت على 6. أولا، التصويت على 5:

![الإنقسامات أو الشوكات (forks) بعد الضغط (pruning)](/img/forks-pruned.svg)

الجذر (root) الجديد هو 2، وأي إنقسامات أو شوكات نشطة (active forks) لا تنحدر من الجذر (root) عدد 2 يتم ضغطها (pruned).

كبديل لذلك، التصويت على 6:

![الإنقسامات أو الشوكات (Forks)](/img/forks-pruned2.svg)

تظل الشجرة ذات جذر (root) عدد 1، لأن الإنقسام أو الشوكة النشطة (active fork) التي تبدأ من 6 تبعد فقط مسافة عدد 2 نقاط التَحَقُّق (checkpoints) من الجذر (root).
