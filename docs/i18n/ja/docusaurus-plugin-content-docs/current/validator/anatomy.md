---
title: バリデータの解剖図
---

![Validator block diagram](/img/validator.svg)

## パイプライン

バリデータには、*パイプライン*と呼ばれる CPU 設計で一般的な最適化手法が多用されています。 パイプライン化は、一連のステップで処理する必要のある入力データの流れがあり、それぞれを担当するハードウェアが異なる場合に適したツールです。 典型的な例は、"洗濯機"と"乾燥機"を使って複数の洗濯物を"洗い"、"乾燥させ"、"たたむ"ことです。 洗濯は乾燥の前に、乾燥は折りたたむ前に行わなければなりませんが、この 3 つの操作はそれぞれ別のユニットで行われます。 効率を最大化するためには、*ステージ*のパイプラインを作ります。 ここでは、"洗濯機"を 1 つ目のステージ、"乾燥機"を２つ目のステージ、そして"折り畳み工程"を 3 つ目のステージと呼びます。 パイプラインを実行するには、1 回目の洗濯物を乾燥機に投入した直後に、2 回目の洗濯物を洗濯機に投入します。 同様に、2 回目の洗濯物が乾燥機に入り、1 回目の洗濯物が折り畳まれた後に、3 回目の洗濯物を洗濯機に入れます。 このようにして、3 つの洗濯物を同時に進めることができるのです。 無限の洗濯物がある場合、パイプラインは一貫して、パイプラインの中で最も遅い段階の速度で洗濯物を完成させます。

## バリデータでのパイプライン

バリデーターには 2 つのパイプライン化されたプロセスがあり、1 つは"TPU"と呼ばれるリーダモードで使用され、もう 1 つは"TVU"と呼ばれるバリデータモードで使用されます。 どちらの場合も、パイプライン化されるハードウェアは同じで、"ネットワーク入力"、"GPU カード"、"CPU コア"、"ディスクへの書き込み"、"ネットワーク出力"です。 そのハードウェアで何をするかは異なります。 "TPU"は台帳のエントリを作成するために存在するのに対し、"TVU"はそれを検証するために存在します。
