---
title: Bankless Leader
---

バンクレスリーダは、有効なブロックを生成するために最小限の作業を行います。 リーダは、トランザクションを入力し、有効なトランザクションをソートしてフィルタリングし、エントリに整理し、エントリをシュレッダーにかけ、シュレッダーをブロードキャストするというタスクを担当します。 一方、バリデータはブロックを再構築し、うまく形成されたエントリーの実行を再生するだけで良いです。 リーダは処理されたトランザクションごとに、バリデーターの3倍のメモリ操作をバンク実行前に行います。

## 根拠

通常の銀行業務では、2つのロードと2つのストアを行う必要があります。 今回の設計では、リーダーは1回のロードで済むので、 ブロックを生成する前の"account_db"の作業が4倍少なくなります。 ストア操作は、リードよりもコストがかかると思われます。

再生ステージが同じトランザクションの処理を開始すると、PoHが有効であり、すべてのエントリが並列実行しても安全であると仮定できます。 ブロックを生成するためにロードされた料金アカウントは、まだメモリ内にあると思われるので、追加のロードは暖かく、コストは償却されると思われます。

## フィーアカウント

[料金アカウント](../terminology.md#fee_account)は、ブロックに含まれるトランザクションの料金を支払います。 リーダが必要なのは、手数料口座に手数料を支払うだけの残高があるかどうかを検証することだけです。

## 残高キャッシュ

リーダが連続するブロックの間、リーダは処理されたすべてのフィーアカウントの一時的なバランスキャッシュを維持します。 このキャッシュは、"公開キー"と"ランポート"のマップです。

最初のブロックの開始時には、バランスキャッシュは空です。 最後のブロックの終わりに、キャッシュは破壊されます。

残高キャッシュの検索は、キャッシュの全期間にわたって同じベースフォークを参照しなければなりません。 ブロック境界では、再生ステージが前のブロックの検証を終えた後に、ベースフォークとともにキャッシュをリセットすることができます。

## 残高チェック

バランスチェックの前に、リーダはトランザクション内のすべての署名を検証します。

1. アカウントが使用されておらず、BlockHashが有効であることを確認します。
2. 料金アカウントがキャッシュに存在するか、"accounts_db"からアカウントを読み込み、ランポートの残高をキャッシュに保存するかを確認します。
3. 残高が手数料より少なければ、その取引を中止します。
4. 残高から手数料を引きます。
5. トランザクション内のすべてのキーが"Credit-Debit"であり、かつ命令によって参照されている場合、キャッシュ内でその残高を0にします。 アカウントフィーは"Credit-Debit"として宣言されているが、どの命令でも使用されない限り、その残高は0にはなりません。

## リーダリプレイ

リーダは、標準のリプレイステージ操作の一部として、ブロックをリプレイする必要があります。

## 連続したブロックでのリーダリプレイ

リーダは、複数のブロックを連続して制作するようにスケジュールされることがあります。 このシナリオでは、リーダは最初のブロックのリプレイステージが再生されている間に次のブロックを生成することになります。

リーダがリプレイステージを終了すると、バランスキャッシュをクリアしてリセットし、次のブロックで有効になるキャッシュのベースとして新しいフォークを設定することができます。

## 残高キャッシュのリセット

1. ブロックの開始時に、バランスキャッシュが初期化されていない場合は、バランスキャッシュのベースフォークをブロックの親に設定し、空のキャッシュを作成します。
2. キャッシュが初期化されている場合、ブロックの親がバランスキャッシュの現在のベースフォークよりも新しい新しい凍結バンクを持っているかどうかをチェックします。
3. キャッシュのベースフォークよりも新しい親が存在する場合は、キャッシュをその親にリセットします。

## クライアントへの影響

同一の手数料口座は、インストラクションによりクレジットデビットとして一度使用されるまでは、同一ブロック内で何度でも再使用することができます。

1秒間に大量のトランザクションを送信するクライアントは、いずれの命令でも"Credit-Debit"として使用されない専用の手数料アカウントを使用する必要があります。

一度"Credit-Debit"として使用されたアカウントフィーは、バランスキャッシュがリセットされるまで、バランスチェックに失敗します。
