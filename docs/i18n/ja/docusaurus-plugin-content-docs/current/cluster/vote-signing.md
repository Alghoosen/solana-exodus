---
title: 安全な投票署名
---

バリデーターは現在のリーダからエントリを受け取り、そのエントリが有効であることを確認するために投票を提出します。 この投票の提出にはセキュリティ上の課題があります。というのも、コンセンサスのルールに違反した偽造投票がバリデータの賭け金を削るのに使われる可能性があるからです。

バリデータは、非対称キーを使用して検証作業の結果に署名するトランザクションを送信することによって、選択されたフォークに投票します。 他のエンティティは、バリデータの公開キーを使用して、この署名を検証できます。 バリデータのキーが不正なデータに署名するために使用される場合 \(例： 台帳の複数のフォークに投票する)、ノードのステーキングまたはそのリソースが侵害される可能性があります。

Solana は、それぞれの投票を評価する別の _vote signer_ サービスを分割することで、このリスクに対処します。

## 承認者、投票者、ステーキングホルダ

バリデータが同じスロットに対して複数のブロックを受信すると、すべての可能なフォークを"最善の"ブロックを決定するまで追跡します。 バリデータは、投票を行うことで、最良のフォークを選択します。 投票署名者を使って投票の可能性を最小限に抑えるために 合意ルールに違反し ステークを切り捨てた

投票署名者は、バリデータによって提案された投票を評価し、その投票はスラッシング条件に違反しない場合にのみ署名します。 投票署名者は、それが署名した投票とクラスターの残りの署名した投票に関して、最小限の状態を維持する必要があります。 完全なトランザクションを処理する必要はありません。

ステーキングホルダーとは、ステーキングされた資本をコントロールするアイデンティティです。 ステーキングホルダーは、そのステーキングを投票署名者に委任することができます。 一度ステーキングが委任されると、投票署名者の投票は、委任されたすべてのステーキングの投票重量を表します。 委任された全ての賭けに対して報酬を生み出すのです

現在、バリデータと投票署名者の間には 1:1 の関係があり、ステーキングホルダーはそのステーキング全体を単一の投票署名者に委任します。

## 署名サービス

投票署名サービスは、JSON RPC サーバーとリクエストプロセッサで構成されています。 起動時に、サービスは設定されたポートで RPC サーバーを起動し、バリデータのリクエストを待ちます。 リクエストの種類は次のとおりです。

1. 新しいバリデータノードを登録しよう

   - T リクエストにはバリデータの ID が必要です。\(パブキー\)
   - リクエストはバリデータの秘密キーで署名する必要があります。
   - リクエストの署名が検証できない場合、サービスはリクエストを削除します。
   - このサービスは、バリデータ用の新しい投票用非対称キーを作成し、その公開キーをレスポンスとして返します。
   - バリデータがもう一度登録しようとすると、サービスは既存のキーペアから公開キーを返します。

2. 投票に署名しよう

   - リクエストには投票取引とすべての検証データを含める必要があります
   - リクエストはバリデータの秘密キーで署名する必要があります。
   - リクエストの署名が検証できない場合、サービスはリクエストを削除します。
   - このサービスは投票データを検証します。
   - サービスはトランザクションの署名を返します。

## バリデータ投票

検証ノードは、スタートアップ時に新しい投票アカウントを作成し、新しい"投票登録"トランザクションを送信することでクラスタに登録します。 クラスタ上の他のノードはこのトランザクションを処理し、新しいバリデータをアクティブなセットに含めます。 その後、バリデータは、各投票イベントでバリデータの投票秘密鍵で署名された"新しい投票"トランザクションを送信します。

### 設定

検証ノードは、署名サービスのネットワークエンドポイント\(IP/ポート\) で構成されます。

### 登録

起動時に、バリデータは JSON RPC を使用して署名サービスを登録します。 RPC コールは、バリデータノードの投票公開キーを返します。 バリデータは、この公開キーを含む新しい"投票登録"トランザクションを作成し、クラスタに送信します。

### 投票コレクション

このバリデータは、クラスター内のすべてのノードが最後に投票期間に提出した投票を検索します。 この情報は新しい投票署名リクエストとともに署名サービスに送信されます。

### 新しい投票署名

バリデータは"新しい投票"トランザクションを作成し、JSON RPC を使用して署名サービスに送信します。 RPC リクエストには、投票検証データも含まれます。 成功した場合、RPC 呼び出しは投票の署名を返します。 失敗すると、RPC 呼び出しは失敗コードを返します。
