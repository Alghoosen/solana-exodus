---
title: Solanaクラスタ
---

Solana クラスタとは、クライアントのトランザクションを処理し、台帳の整合性を維持するために協調して働くバリデータの集合のことです。 多くのクラスタが共存することもあります。 2 つのクラスタが共通のジェネシスブロックを共有している場合、それらは収束しようとします。 そうでなければ、クラスタは相手の存在を無視するだけです。 間違ったクラスタに送られたトランザクションは静かに拒否されます。 このセクションでは、クラスタの作成方法、ノードがクラスタに参加する方法、クラスタが台帳を共有する方法、台帳の複製を保証する方法、バグや悪意のあるノードに対処する方法について説明します。

## クラスタの作成

バリデータを起動する前に、まず*genesis の設定*を作成する必要があります。 この設定では、2 つの公開キー、*mint*と、*ブートストラップバリデータ*を参照します。 ブートストラップバリデータの秘密キーを持つバリデータは、台帳に最初のエントリを追加する役割を果たします。 バリデータは、ミントのアカウントで内部状態を初期化します。 このアカウントはジェネシスコンフィグで定義された数のネイティブトークンを保持します。 2 番目のバリデータは、起動時のバリデータに連絡して*バリデータ*として登録します。 追加のバリデータは、クラスタに登録されている任意のメンバーに登録します。

バリデータはリーダからすべてのエントリを受け取り、それらのエントリが有効であることを確認するために投票を行います。 投票後、バリデータはそのエントリを保存することになっています。 バリデータは、十分な数のコピーが存在することを確認したら、 自分のコピーを削除します。

## クラスターへ参加しよう

バリデータは、*コントロールプレーン*に送られる登録メッセージによってクラスタに入ります。 コントロールプレーンは*ゴシップ*プロトコルを使用して実装されており、ノードは既存のノードに登録することができ、その登録がクラスタ内のすべてのノードに伝搬することが期待されます。 すべてのノードが同期するのにかかる時間は、クラスタに参加しているノードの数の二乗に比例します。 アルゴリズム的には非常に遅いとされていますが、その時間と引き換えに、ノードは最終的に他のすべてのノードと同じ情報を持ち、その情報がどのノードによっても打ち切られないことが保証されます。

## クラスタへトランザクションの送信をしよう

クライアントは、任意のバリデータのトランザクション処理ユニット\(TPU\)、ポートにトランザクションを送信します。 ノードがバリデータの役割を担っている場合、そのノードは指定されたリーダーにトランザクションを転送します。 リーダーの役割を担っている場合、ノードは受信したトランザクションを束ね、タイムスタンプを付けて*エントリ*を作成し、クラスタの*データプレーン*にプッシュします。 データプレーンに乗ったトランザクションはバリデータノードによって検証され、効果的に台帳に追加されます。

## トランザクションの確認をしよう

Solana クラスターでは、150 ノードまではサブセカンドでの*確認*が可能だが、数十万ノードにまでスケールアップする予定です。 完全に実装されると、確認時間はバリデータ数の対数だけ増加すると予想されますが、対数のベースは非常に高いです。 例えば基数が 1,000 の場合、最初の 1,000 ノードの確認時間は、3 回のネットワークホップの時間に、超過半数の最も遅いバリデータが投票するまでの時間を加えたものになるということです。 次の 100 万ノードでは、確認は 1 ネットワークホップだけ増加します。

Solana の確認とは、リーダが新しいエントリをタイムスタンプしてから、リーダが台帳の超過半数の票を認識する瞬間までの期間と定義しています。

ゴシップネットワークでは、ネットワークの規模が一定以上になると、サブセカンドの確認を実現するには遅すぎます。 すべてのノードにメッセージを送信するのにかかる時間は、ノード数の二乗に比例します。 ブロックチェーンが低確度を達成したい場合、ゴシップネットワークを使ってそれを実現しようとすると、一握りのノードに集中することを余儀なくされます。

以下の手法を組み合わせることで、スケーラブルな確認が可能です。

1. VDF サンプルを使ってトランザクションにタイムスタンプを付け、そのタイムスタンプに署名します。
2. トランザクションをバッチに分割し、それぞれを別々のノードに送信して

   各ノードは、そのバッチをピアと共有します。

3. すべてのノードがすべてのバッチを持つようになるまで、前のステップを再帰的に繰り返します。

Solana では、*スロット*と呼ばれる一定の間隔でリーダーを交代させています。 各リーダは、割り当てられたスロット内でのみエントリを作成することができます。 したがって、リーダはトランザクションにタイムスタンプを打ち、検証者が指定されたリーダの公開キーを調べられるようにします。 次にリーダはタイムスタンプに署名し、検証者がその署名を検証することで、署名者が指定されたリーダーの公開キーの所有者であることを証明します。

次に、ノードが複数のコピーを作成せずに複数の相手にトランザクションを送信できるように、トランザクションをバッチに分割します。 例えば、リーダが 60 のトランザクションを 6 つのノードに送る必要がある場合、リーダは 60 のコレクションを 10 のトランザクションのバッチに分割し、各ノードに 1 つずつ送ります。 これにより、リーダは各ノードに 60 のトランザクションを送信するのではなく、60 のトランザクションをワイヤに送信することができます。 各ノードはその後、そのバッチをピアと共有します。 ノードが 6 つのバッチをすべて集めたら、元の 60 トランザクションのセットを再構築します。

トランザクションのバッチを分割できる回数は限られており、ヘッダー情報がネットワーク帯域幅の主な消費者となるほど小さくなります。 この記事を書いている時点では、このアプローチは 150 人程度のバリデータまでは順調に拡大しています。 何十万ものバリデータに対応するためには、各ノードがリーダーノードと同じ技術を同じサイズの別のノードセットに適用すれば良いです。 この手法を [_Turbine Block Propogation_](turbine-block-propagation.md) と呼んでいます。
