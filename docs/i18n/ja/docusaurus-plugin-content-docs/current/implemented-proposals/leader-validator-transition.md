---
title: リーダー同士の移行
---

バリデーターは通常、ブロックの検証に時間を費やします。 しかし、ステーキングホルダがバリデータにステーキングを委任した場合、そのバリデータが*スロットリーダ*に選ばれることもあります。 スロットリーダとなったバリデータは、割り当てられた*スロット*でブロックを生成する責任を負います。 スロットは事前に設定されたいくつかの*ティック*の持続時間を持ちます。 これらのティックの長さは、後述する*PoH Recorder*を使って推定します。

## BankFork

BankFork は、特定のスロットにおける Bank の状態の変化を追跡します。 最後のティックが登録されると、その状態は凍結されます。 書き込もうとしても拒否されます。

## バリデータ

バリデーターは、リーダースロット内の高さの PoH ハッシュを生成するまで、Bank の状態の多くの異なる同時フォークを操作します。

## スロットリーダ

スロットリーダは、最後に投票した 1 つのフォークの上にのみブロックを構築します。

## PoH Recorder

スロットリーダとバリデータは、スロットの高さを推定したり、取引を記録するために PoH Recorder を使用します。

### バリデーション時の PoH レコーダー

PoH Recorder は、検証時にはシンプルな VDF として機能します。 これは、バリデータがスロットリーダの役割に切り替わる必要があるときに、 バリデータに伝えるものです。 バリデータはフォークに投票するたびに、そのフォークの最新の[ブロックハッシュ](../terminology.md#blockhash)を使って VDF を再シードするべきです。 再シードは 2 つの問題を解決します。 1 つ目は、自分の VDF とリーダーの VDF を同期させることで、 自分のリーダー枠がいつ始まるのかをより正確に判断できるようになります。 2 つ目は、前のリーダーがダウンした場合、次のリーダーの PoH ストリームですべてのウォールクロックの時間が考慮されることです。 例えば、リーダーがスタートした時に 1 ブロック足りなかった場合、そのリーダーが生成するブロックの PoH 時間は 2 ブロックになるはずです。 長くすることで、次のリーダーが前のリーダーのスロットからすべてのトランザクションを切り取ろうとしないようにします。

### リーディング時の PoH レコーダー

スロットリーダーは、PoH Recorder を使って取引を記録し、自分の位置を時間的にロックします。 PoH ハッシュは、前のリーダーの最後のブロックから派生したものでなければなりません。 派生していない場合、そのブロックは PoH 検証に失敗し、クラスタに拒否されます。

PoH Recorder は、スロットリーダーに自分のスロットが終了したことを知らせる役割も果たします。 リーダは、トランザクションを記録することで指定したスロットの外で PoH の高さが発生する場合、バンクを変更しないように注意する必要があります。 したがって、リーダはエントリの PoH ハッシュを生成するまでアカウントの変更をコミットしてはいけません。 PoH の高さがスロットの外に出たとき、そのパイプラインにあるすべてのトランザクションはドロップするか、次のリーダに転送することができます。 転送は、ネットワークの混雑を最小限に抑え、クラスターがより高い TPS 容量を広告できるようにするために好ましいものです。

## バリデータループ

モード間の移行は、PoH Recorder が管理します。 台帳が再生されると、レコーダーがスロットリーダになるべきだと指示するまでバリデータは実行することができます。 スロットリーダになると、ノードはトランザクションを実行して記録することができます。

ループは PoH に同期しており、スロットリーダー機能の同期的な開始と停止を行います。 停止後、バリデータの TVU は別のリーダーが同じブロックを送信した場合と同じ状態になっているはずです。 以下は、このループの擬似コードです。

1. 次の割り当てられたスロットを"LeaderScheduler"に問い合わせます。
2. TVU をすべてのフォークにかけます。 1. TVU は"ベスト"と思われるフォークに投票を送ります。 2. 各投票の後、"PoH Recorder"を再起動し、次の割り当てられたスロットまで実行します。

   。

3. スロットリーダーになる時は TPU を起動します。 最後のフォークに向けて

   を指します。

4. スロットが終了するまでエントリを作成します。 1. スロットが終了するまでの間、TVU は他のフォークに投票してはいけません。 2. スロット終了後、TPU は"BankFork"を凍結します。 凍結後、

   "TVU"は投票を再開することができます。

5. 1 に戻ります。
