---
title: リーダー同士の移行
---

バリデーターは通常、ブロックの検証に時間を費やします。 しかし、ステーキングホルダがバリデータにステーキングを委任した場合、そのバリデータが_スロットリーダ_に選ばれることもあります。 スロットリーダとなったバリデータは、割り当てられた_スロット_でブロックを生成する責任を負います。 スロットは事前に設定されたいくつかの_ティック_の持続時間を持ちます。 これらのティックの長さは、後述する_PoH Recorder_を使って推定します。

## BankFork

BankForkは、特定のスロットにおけるBankの状態の変化を追跡します。 最後のティックが登録されると、その状態は凍結されます。 書き込もうとしても拒否されます。

## バリデータ

バリデーターは、リーダースロット内の高さのPoHハッシュを生成するまで、Bankの状態の多くの異なる同時フォークを操作します。

## スロットリーダ

スロットリーダは、最後に投票した1つのフォークの上にのみブロックを構築します。

## PoH Recorder

スロットリーダとバリデータは、スロットの高さを推定したり、取引を記録するためにPoH Recorderを使用します。

### バリデーション時のPoHレコーダー

PoH Recorderは、検証時にはシンプルなVDFとして機能します。 これは、バリデータがスロットリーダの役割に切り替わる必要があるときに、 バリデータに伝えるものです。 バリデータはフォークに投票するたびに、そのフォークの最新の[ブロックハッシュ](../terminology.md#blockhash)を使ってVDFを再シードするべきです。 再シードは2つの問題を解決します。 1つ目は、自分のVDFとリーダーのVDFを同期させることで、 自分のリーダー枠がいつ始まるのかをより正確に判断できるようになります。 2つ目は、前のリーダーがダウンした場合、次のリーダーのPoHストリームですべてのウォールクロックの時間が考慮されることです。 例えば、リーダーがスタートした時に1ブロック足りなかった場合、そのリーダーが生成するブロックのPoH時間は2ブロックになるはずです。 長くすることで、次のリーダーが前のリーダーのスロットからすべてのトランザクションを切り取ろうとしないようにします。

### リーディング時のPoHレコーダー

スロットリーダーは、PoH Recorderを使って取引を記録し、自分の位置を時間的にロックします。 PoHハッシュは、前のリーダーの最後のブロックから派生したものでなければなりません。 派生していない場合、そのブロックはPoH検証に失敗し、クラスタに拒否されます。

PoH Recorderは、スロットリーダーに自分のスロットが終了したことを知らせる役割も果たします。 リーダは、トランザクションを記録することで指定したスロットの外でPoHの高さが発生する場合、バンクを変更しないように注意する必要があります。 したがって、リーダはエントリのPoHハッシュを生成するまでアカウントの変更をコミットしてはいけません。 PoHの高さがスロットの外に出たとき、そのパイプラインにあるすべてのトランザクションはドロップするか、次のリーダに転送することができます。 転送は、ネットワークの混雑を最小限に抑え、クラスターがより高いTPS容量を広告できるようにするために好ましいものです。

## バリデータループ

モード間の移行は、PoH Recorderが管理します。 台帳が再生されると、レコーダーがスロットリーダになるべきだと指示するまでバリデータは実行することができます。 スロットリーダになると、ノードはトランザクションを実行して記録することができます。

ループはPoHに同期しており、スロットリーダー機能の同期的な開始と停止を行います。 停止後、バリデータのTVUは別のリーダーが同じブロックを送信した場合と同じ状態になっているはずです。 以下は、このループの擬似コードです。

1. 次の割り当てられたスロットを"LeaderScheduler"に問い合わせます。
2. TVUをすべてのフォークにかけます。 1. TVUは"ベスト"と思われるフォークに投票を送ります。 2. 各投票の後、"PoH Recorder"を再起動し、次の割り当てられたスロットまで実行します。

   。

3. スロットリーダーになる時はTPUを起動します。 最後のフォークに向けて

   を指します。

4. スロットが終了するまでエントリを作成します。 1. スロットが終了するまでの間、TVUは他のフォークに投票してはいけません。 2. スロット終了後、TPUは"BankFork"を凍結します。 凍結後、

   "TVU"は投票を再開することができます。

5. 1に戻ります。
