---
title: 確定的なトランザクションフィー
---

現在、トランザクションには、スロットリーダがトランザクションを処理するために課金することが許される最大の料金フィールドを示す料金フィールドが含まれています。 一方、クラスタは最低料金に合意します。 ネットワークが混雑している場合、スロットリーダーは、より高い手数料を提示しているトランザクションを優先することがあります。 つまり、クライアントは、クラスターによってトランザクションが確認され、残額が確認されるまで、いくら徴収されたのかを知ることができません。 これは、私たちが嫌っているイーサリアムの"gas"で、非決定論の匂いがします。

## Congestion-driven fees

バリデータは*signature per slot* \(SPS\) を用いてネットワークの混雑状況を推定し、*SPS 目標値*を用いてクラスターの希望する処理能力を推定します。 バリデータは"genesis config"から"SPS 目標値"を学習しますが、"SPS"は最近処理されたトランザクションから計算されます。 The genesis config also defines a target `lamports_per_signature`, which is the fee to charge per signature when the cluster is operating at _SPS target_.

## 手数料の計算

クライアントは"JSON RPC API"を使用して、現在の料金パラメータをクラスタに問い合わせます。 これらのパラメータはブロックハッシュでタグ付けされ、そのブロックハッシュが古くなってスロットリーダに拒否されるまで有効です。

クラスタにトランザクションを送信する前に、クライアントはトランザクションと手数料アカウントのデータを*手数料計算機*と呼ばれる SDK モジュールに送信することができます。 クライアントの SDK のバージョンがスロットリーダーのバージョンと一致する限り、クライアントのアカウントには、フィーカリキュレーターから返された数とまったく同じ数のランポートが変更されることが保証されます。

## 手数料パラメータ

この設計の最初の実装では、料金パラメータは`lamports_per_signature`のみです。 クラスタが検証する必要のあるシグネチャの数が多ければ多いほど、手数料は高くなります。 ランポートの正確な数は、"SPS ターゲット"に対する"SPS"の比率によって決定されます。 各スロットの終了時に、クラスタは SPS が目標値を下回っている場合は`lamports_per_signature`を下げ、目標値を上回っている場合は上げます。 `lamports_per_signature`の最小値は目標`lamports_per_signature`の 50％、最大値は目標の 10 倍となります。

将来のパラメータは次のとおりです:

- `lamports_per_pubkey` -アカウントをロードするためのコスト
- `lamports_per_slot_distance` - 非常に古いアカウントをロードするための高いコスト
- `lamports_per_byte` - 読み込むアカウントのサイズごとのコスト
- `lamports_per_bpf_instruction` - プログラムを実行するためのコスト

## 攻撃

### "SPS Target" をハイジャックする

バリデータのグループは、他のバリデータが追従できる範囲内で"SPS 目標値"を引き上げるように説得することができれば、クラスタを集中管理することができます。 目標値を上げれば手数料が下がり、需要が増えて TPS が上がると思われます。 もしバリデータがそれほど多くのトランザクションを高速に処理できる ハードウェアを持っていなければ、その確認票は最終的に非常に長くなり、 クラスタはそのバリデータを起動せざるを得なくなるでしょう。
