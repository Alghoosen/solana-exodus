---
title: Тест кластера
---

Репозиторий git Solana содержит все скрипты, которые вам могут потребоваться для запуска вашего собственного локального testnet. В зависимости от того, что вы хотите получить, вы можете захотеть запустить другую вариацию, как полное, усовершенствованная многоузловая testnet позволяет значительно сложнее настройки, чем просто Rust-only и singlenode testnode. Если вы хотите разработать высокоуровневые функции, такие как эксперименты с смарт-контрактов, сохраните некоторые настройки головного боя и придерживайтесь только одного демо-режима Rust. Если вы делаете оптимизацию транзакционного трубопровода, подумайте о расширенном одноименном демо. Если вы выполняете консенсусную работу, вам понадобится по крайней мере многоузловое демо. Если вы хотите воспроизвести наши TPS метрики, запустите расширенное многоузловое демо.

Для всех четырех вариантов вам потребуется последняя цепочка инструментов Rust и исходный код Solana:

Сначала настройте Расстояние, Карго и системные пакеты, как описано в Solana [README](https://github.com/solana-labs/solana#1-install-rustc-cargo-and-rustfmt)

Теперь просмотрите код из github:

```bash
git clone https://github.com/solana-labs/solana.git
cd solana
```

Демо-код иногда нарушается между выпусками при добавлении новых низкоуровневых функций, так что если вы впервые запускаете демо, вы улучшите свои шансы на успех, если вы взгляните на [последнюю версию](https://github.com/solana-labs/solana/releases) прежде чем продолжить:

```bash
TAG=$(git describe --tags $(git rev-list --tags --max-count=1))
git checkout $TAG
```

### Настройка конфигурации

Убедитесь, что важные программы, такие как программа голосования, создаются до запуска узлов. Обратите внимание, что мы используем сборку релиза здесь для хорошей работы. Если вы хотите отладочную сборку, используйте только `грузовую сборку` и опустите `NDEBUG=1` часть команды.

```bash
грузовая сборка --release
```

Сеть инициализирована с помощью genesis ledger, генерируемого при запуске следующего скрипта.

```bash
NDEBUG=1 ./multinode-demo/setup.sh
```

### Кран

Для работы валидаторов и клиентов нам необходимо запустить кран для выдачи некоторых тестовых токенов. Люк доставляет "воздушные капчики" в стиле Milton Friedman \(бесплатные токены запросу клиентов\) для использования в тестовых транзакциях.

Запустить кран с:

```bash
NDEBUG=1 ./multinode-demo/faucet.sh
```

### Одноузловая тестовая сеть

Перед тем как запустить валидатор, убедитесь, что вы знаете IP адрес машины, которую вы хотите назвать валидатором начальной версии демо, и убедитесь, что порты 8000-10000 открыты на всех машинах, с которыми вы хотите протестировать.

Теперь запустите валидатор начальной загрузки в отдельной оболочке:

```bash
NDEBUG=1 ./multinode-demo/bootstrap-validator.sh
```

Подождите несколько секунд для инициализации сервера. Он будет печатать "leader ready..." когда будет готов к получению транзакций. Лидер запросит некоторые токены у крана, если у него нет. Кран не должен быть запущен для последующего запуска лидера.

### Тест нескольких узлов

Чтобы запустить тестовую сеть мультиузлов, после запуска ведущего узла, вставьте несколько дополнительных валидаторов в отдельные оболочки:

```bash
NDEBUG=1 ./multinode-demo/validator-x.sh
```

Для запуска улучшенного валидатора на Linux, в системе должна быть установлена [CUDA 10.0](https://developer.nvidia.com/cuda-downloads):

```bash
./fetch-perf-libs.sh
NDEBUG=1 SOLANA_CUDA=1 ./multinode-demo/bootstrap-validator.sh
NDEBUG=1 SOLANA_CUDA=1 ./multinode-demo/validator.sh
```

### Демонстрация клиента testnet

Теперь, когда ваш singlenode или multinode testnet уже запущен, давайте отправим вам несколько транзакций!

В отдельной оболочке запустите клиент:

```bash
NDEBUG=1 ./multinode-demo/bench-tps.sh # запускается против localhost по умолчанию
```

Что только что произошло? Демо клиента запускает несколько потоков, чтобы как можно быстрее отправить 500,000 транзакций в testnet. Затем клиент периодически пингует testnet для того, чтобы увидеть, сколько транзакций он обрабатывал за это время. Обратите внимание, что демо-версия намеренно наводняет сеть с UDP-пакетами, таким образом, что сеть почти наверняка удалит кучу из них. Это гарантирует, что testnet имеет возможность достичь 710k TPS. Демонстрация клиента завершается после того, как он убедился, что testnet не обрабатывает никаких дополнительных транзакций. Вы должны увидеть несколько измерений, напечатанных на экран. В варианте с несколькими узлами вы увидите измерения TPS для каждого узла валидатора.

### Отладка testnet

В коде есть несколько полезных отладочных сообщений, которые можно включить для каждого модуля и для каждого уровня. Перед запуском лидера или валидатора установите нормальную переменную окружения RUST_LOG.

Например

- Чтобы включить `информацию` везде и `отладки` только в solana::banking_stage module:

  ```bash
  экспорт RUST_LOG=solana=info,solana:banking_stage=debug
  ```

- Чтобы включить запись в журнал программы BPF:

  ```bash
  экспорт RUST_LOG=solana_bpf_loader=trace
  ```

Обычно мы используем `отладку` для нежелательных отладочных сообщений, `трассировку` потенциально частых сообщений и `информацию` для протоколирования связанных с производительностью.

Вы также можете прикрепить к текущему процессу с GDB. Лидерский процесс называется _solana-validator_:

```bash
sudo gdb
прикрепить <PID>
набор логирования
применить все bt
```

Это позволит выбросить все треки из стека потоков в gdb.txt

## Тестовая сеть разработчика

В этом примере клиент подключается к нашей публичной тестовой сети. Для запуска валидаторов в testnet вам необходимо открыть порты udp `8000-10000`.

```bash
NDEBUG=1 ./multinode-demo/bench-tps.sh --entrypoint devnet.solana.com:8001 --faucet devnet.solana.com:9900 --duration 60 --tx_count
```

Вы можете наблюдать эффекты транзакций вашего клиента на [панели инструментов](https://metrics.solana.com:3000/d/monitor/cluster-telemetry?var-testnet=devnet)
