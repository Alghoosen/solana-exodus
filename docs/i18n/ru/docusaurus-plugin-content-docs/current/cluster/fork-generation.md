---
title: Создание форка
---

В этом разделе описывается, как естественным образом происходят форки в результате ротации [лидера](leader-rotation.md).

## Общий обзор

Узлы становятся лидером и генерируют PoH, который кодирует изменения состояния. Кластер может допустить потерю связи с любым лидером путем синтеза того, что лидер _****_ сформировался, если он был подключен, но не вредит изменениям состояния. Таким образом, возможное количество вилок ограничено "такой/нет-такой" списком вилок, которые могут возникнуть в границах игровых автоматов лидера. В любом слоте будут приниматься только операции одного лидера.

## Поток сообщений

1. Транзакции перегружены текущим лидером.
2. Фильтры лидеров, действительные транзакции.
3. Лидер выполняет действительные транзакции, обновляя их состояние.
4. Пакеты Лидера проводят операции с записями на основе текущего слота PoH.
5. Лидер передает записи в узлы валидатора \(in signed shreds\)
   1. Поток PoH включает тики; пустые записи, которые указывают на то, что лидер и отрыв времени на кластере.
   2. Поток лидера начинается с тиков, необходимых для того, чтобы завершить РоН обратно к последнему наблюдавшемуся игровому слоту лидера.
6. Валидаторы пересылают записи узлам в их наборе и далее по каналам узлов.
7. Валидаторы проверяют транзакции и выполняют их в их состоянии.
8. Валидаторы вычисляют хэш состояния.
9. В определенное время, т.е. в конкретном РоН числе, валидаторы передают голоса лидеру.
   1. Голоса - это подписи хэша вычисленного состояния на этом РоН тик.
   2. Голоса также распространяются с помощью схода.
10. Лидер выполняет голосование, то же самое что и любая другая транзакция, и передает их кластеру.
11. Валидаторы наблюдают за своими голосами и всеми голосами от кластера.

## Разделы, Форки

Форки могут возникать в PoH тике счетчики, которые соответствуют голосованию. Следующий лидер может не наблюдать за последним слотом голосования и может начать свой слот с генерируемыми записями virtual PoH. Эти пустые тики генерируются всеми узлами в кластере с настроенной скоростью кластера для хэшей/пер/делки `Z`.

Существует только две возможные версии PoH во время голосования: PoH с `T` тактами и записями, сгенерированными текущим лидером, или плохо с просто тиками. "просто тики" версии PoH можно рассматривать как виртуальную книгу, что все узлы в кластере могут быть получены от последнего тика в предыдущем слоте.

Валидаторы могут игнорировать форки в других точках \(например от неправильного лидера\) или нажать на лидера ответственного за ответ.

Валидаторы голосуют на основе жадного выбора, чтобы максимизировать свою награду, описанную в [TowerBFT](../implemented-proposals/tower-bft.md).

### Просмотр валидатора

#### Прогресс времени

На диаграмме ниже показано представление валидатора о РоН потоке с возможными форками со временем. L1, L2 и т. д. являются слотами лидеров, и `E`s представляют записи этого лидера во время слота лидера. `х`сек представляет только тики, а время течет вниз на диаграмме.

![Создание форка](/img/fork-generation.svg)

Обратите внимание, что `E` появляются на 2 ветки в том же ячейке является приемлемым условием, так что валидатор наблюдает за `E3` и `E3'` может нажать L3 и безопасно выбрать `x` для этого слота. После того, как валидатор совершает коммиты в форк, другие форки могут быть отброшены ниже этого тика. Для любого слота валидаторы должны рассматривать только одну цепочку "имеет записи" или цепочку "только" будет предложена лидером. Но несколько виртуальных записей могут перекрываться, поскольку они ссылаются на предыдущий слот.

#### Деление времени

Полезно рассматривать ротацию лидера над PoH тиком как деление времени для кластера. В нижеследующей таблице представлено вышеуказанное дерево вилок в виде одноразовой по времени книги.

| лидерский слот    | L1 | L2 | L3 | L4 | L5 |
|:----------------- |:-- |:-- |:-- |:-- |:-- |
| данные            | Е1 | Е2 | Е3 | Е4 | Е5 |
| тики с предыдущих |    |    |    | х  | xx |

Обратите внимание, что только данные от лидера L3 будут приниматься во время игрового автомата L3. Данные из L3 могут включать такты "catchup" обратно в ячейку, отличную от L2, если L3 не соблюдает данные L2. Передачи L4 и L5 включают "тики к предупреждению" позиций.

Такое расположение сетевых потоков данных позволяет узлам сохранять именно это в бухгалтерскую книгу для воспроизведения, перезапуска и контрольных пунктов.

### Просмотр Лидера

Когда новый лидер начинает слот, вначале необходимо передать любой PoH \(галочки\), необходимый для связывания нового слота с последним наблюдением и голосованием. Форк лидера, предлагающий связать текущую ячейку с предыдущим ветком, на котором лидер голосовал с виртуальными тиками.
