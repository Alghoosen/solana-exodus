---
title: Ротация Лидера
---

В любой момент кластер ожидает, что только один валидатор будет производить бухгалтерские записи. Имея только одного лидера одновременно, все валидаторы могут повторять одинаковые копии книги. Однако недостаток лишь одного лидера состоит в том, что злонамеренный лидер способен цензурировать голоса и транзакции. Так как цензуру нельзя отличать от сетевых пакетов, кластер не может просто выбрать один узел для хранения роли лидера бессрочно. Вместо этого кластер сводит к минимуму влияние злонамеренного лидера, вращая, какой узел берет на себя лидерство.

Каждый валидатор выбирает предполагаемого лидера с использованием того же алгоритма, который описан ниже. Когда валидатор получает новую подписанную бухгалтерскую книгу, он может быть уверен, что запись была произведена ожидаемым лидером. Порядок слотов, которые назначает каждому лидеру, называется _график лидеров_.

## Ротация Лидера

Валидатор отклоняет блоки, не подписанные _ лидером слота _. Список идентичностей всех лидеров слотов называется _расписание лидеров_. Расписание Лидера пересчитывается локально и периодически. Он назначает лидеров на длительное время под названием _эпоха_. Расписание должно быть рассчитано заблаговременно до назначенных ячеек, таким образом, что состояние бухгалтерской книги оно использует для вычисления графика завершено. Эта продолжительность называется _ смещением расписания лидера _. Solana задает смещение на продолжительность слотов до следующей эпохи. То есть, график лидера эпохи рассчитывается по состоянию бухгалтерской книги в начале предыдущей эпохи. Смещение одной эпохи является достаточно произвольным и, как предполагается, достаточно длинным, чтобы все проверяющие лица завершили свою бухгалтерскую книгу до составления следующего графика. Кластер может сократить смещение для сокращения времени между изменениями ставки и обновлением лидерского расписания.

При работе без разделов длиннее эпохи, расписание нужно генерировать только тогда, когда корневая ветка пересекает границу эпохи. Поскольку расписание на следующую эпоху, любые новые ставки, направленные на корневую ветку, не будут активными до следующей эпохи. Блок, используемый для формирования плана лидера, является первым блоком, пересекающим границу эпохи.

Без раздела, проходящего дольше, чем эпоха, группа будет работать следующим образом:

1. Валидатор постоянно обновляет свои корневые ветки при голосовании.
2. Валидатор обновляет график каждый раз, когда высота слота пересекает границу эпохи.

Например:

Длительность эпохи 100 слотов. Корневая ветка обновляется с высоты слота от ветки 99 до ветки, рассчитанной при высоте слота 102. Форки с ячейками на высоте 100, 101 были пропущены из-за сбоев. Новое расписание лидера рассчитывается с помощью форка на высоте слота 102. Он активен от слота 200 до обновления снова.

Никаких несоответствий не существует, так как каждый валидатор, который проводит голосование с кластером, пропущен 100 и 101 когда его корень проходит 102. Все валидаторы, независимо от формы голосования, будут привержены корню 102, или потомку 102.

### Расписание Лидера поворачивается с Эпохи Разбитых Участков.

Продолжительность сметы смещения руководителя имеет прямое отношение к вероятности кластера с непоследовательным взглядом на правильный график руководителя.

Рассмотрим следующий сценарий:

Два раздела, которые генерируют половину блоков каждой. Ни один из них не приезжает на окончательную ветку супербольшинства. И то и другое перейдет к 100 и 200 эпоху, фактически не взяв на себя обязательств по корню и тем самым взяв на себя обязательства по новому графику лидера.

В этом нестабильном сценарии существует несколько допустимых расписаний лидеров.

- Для каждого форка, непосредственно родителя которого находится в предыдущей эпохе, формируется график лидеров.
- График лидера действителен после начала следующей эпохи для потомков до тех пор, пока не будет обновлен.

Расписание каждого раздела будет изменяться после того, как раздел длится больше чем эпох. По этой причине длительность эпохи должна быть гораздо большим, чем слот-время и ожидаемая длина ветки должна быть привержена root.

После соблюдения кластера достаточно времени, Предварительное смещение может быть выбрано исходя из средней продолжительности раздела и его стандартного отклонения. Например, длиннее смещения, чем медиана продолжительности разделов плюс шесть стандартных отклонений снизит вероятность того, что несогласованный график работы в этой группе вопросов достигнет 1 миллиона.

## Генерация расписания Лидера в Генезисе

Конфиг genesis объявляет первого лидера первой эпохи. Этот лидер заканчивается в соответствии с первыми двумя эпохами, поскольку лидер также формируется в слоте 0 на следующий эпох. Длина первых двух эпох также может быть определена в конфигурации genesis. Минимальная длина первых эпохи должна быть больше или равна максимальной глубине отката, как это определено в [Башне BFT](../implemented-proposals/tower-bft.md).

## Генерация расписания Лидера в Генезисе

Расписание Лидера сгенерировано с помощью предопределенного seed. Этот процесс является следующим:

1. Периодически используйте высоту РоН тика \(монотонно увеличивающийся счет\) для создания стабильного алгоритма псевдослучайного выбора.
2. На этой высоте дайте образец банку для всех счетов с идентификаторами лидера, которые проголосовали в пределах кластера настроенного количества тиков. Образец называется _активным набором_.
3. Сортировка активного по весу пикета.
4. Используйте случайный семенной знак для выбора узлов, взвешенных по цене, чтобы создать расчетно-взвешенный порядок в каждом конкретном случае.
5. Этот порядок становится действительным после настраиваемого кластером количества тиков.

## Расписание Векторов атаки

### Сид

Выбранные семена предсказуемы, но непредсказуемы. Не существует грабежей, влияющих на его результат.

### Активный набор

Лидер может предсказать активный набор путем цензуры валидатора голосов. Для лидеров существует два возможных способа цензуры активного набора:

- Игнорировать голоса от валидаторов
- Отклонить голосование за блоки голосами от валидаторов

Снизить вероятность цензуры, активный набор рассчитывается по границе смещения лидера в течение _активного установленного времени выборки_. Продолжительность отбора активной выборки достаточно длинная, чтобы голоса были собраны несколькими лидерами.

### Стейкинг

Лидеры могут цензурить новые операции разбивки или отказываться проверять блоки с помощью новых ставок. Эта атака аналогична цензуре валидаторов голосов.

### Потеря рабочего ключа валидатора

Руководители и валидаторы должны использовать эфемерные ключи для эксплуатации, а владельцы уполномочивают валидаторов работать с их интересами через делегирование.

Кластер должен быть способен восстановить после потери всех эфемерных ключей, используемых лидерами и валидаторами, которые могут происходить через общую уязвимость программного обеспечения, разделяемую всеми узлами. Владельцы размещения должны иметь возможность голосовать непосредственно путем совместного подписания голосования валидатора, даже если ставка в настоящее время делегирована валидатору.

## Добавление записей

Время жизни расписания лидера называется _эпоха_. Эпоха делится на _слотов_, где продолжительность каждой слота `T` РоН тиков.

Лидер передает записи во время своего слота. После `Т` тиков, все валидаторы переключаются на следующего запланированного лидера. Валидаторы должны игнорировать записи, отправленные вне назначенного лидера.

Все `T` такты должны соблюдаться следующим лидером для того, чтобы создать свои собственные записи. Если записи не замечены \(лидер недоступен\) или записи недопустимы \(лидер ошибочно или злонамеренно\), Следующий лидер должен предъявить тики, чтобы заполнить ячейку предыдущего лидера. Обратите внимание, что следующий лидер должен выполнять запросы на ремонт параллельно, и откладывать отсылку тиков до тех пор, пока он не будет уверен, другие валидаторы также не будут соблюдать предыдущие позиции лидера. Если лидер некорректно строится на собственных листах, то следующий за ним лидер должен заменить все его тики.
