---
title: Безопасное подписание голоса
---

Валидатор получает записи от текущего лидера и подает голоса, подтверждающие правильность этих записей. Это предложение голосования представляет собой вызов безопасности, поскольку поддельные голоса, нарушающие правила консенсуса, могут быть использованы для наследования доли валидатора.

Валидатор голосует за выбранный форк, представив транзакцию, которая использует асимметричный ключ для подписания результатов ее проверки. Другие сущности могут проверить эту подпись, используя публичный ключ валидатора. Если ключ проверки используется для входа некорректных данных \(e.g. голоса на нескольких ветках решетки\), процент узла или его ресурсы могут быть скомпрометированы.

Solana устраняет этот риск, разделяя отдельного _участника голоса,_ который оценивает каждый голос, чтобы убедиться, что он не нарушает условие слэш.

## Валидаторы, Голосующие и Стейкхолдеры

Когда валидатор получает несколько блоков для одного и того же слота, он отслеживает все возможные форки до тех пор, пока не сможет определить "лучшее". Валидатор выбирает лучшие форки, представив ему голос, используя подписчика голосования, чтобы случайно свести к минимуму возможность его голосования, нарушив правило консенсуса и получив слэш.

Участник голосования оценивает голосование, предложенное валидатором, и подписывает голос только в том случае, если он не нарушает условие вычеркивания. Подписчику голосовать нужно только поддерживать минимальное состояние в отношении подписанных голосов, а голоса подписаны остальной частью кластера. Ей не нужно обрабатывать полный набор транзакций.

Заинтересованная сторона - это идентификация, которая имеет контроль над продуманным капиталом. Заинтересованная сторона может делегировать свою долю участнику голосования. Как только определено в делегировании, голоса подписавшего участника голосования представляют голос всех заявок делегаций, и выдачу наград за все делегированные ставки.

В настоящее время существует связь 1:1 между валидаторами и подписчиками голосования, а заинтересованные стороны делегируют всю свою долю одному участнику.

## Подпись сервиса

Служба подписания голосования состоит из JSON RPC сервера и процессора запросов. При запуске служба запускает сервер RPC на заданном порту и ждет проверки запросов. Ожидается следующий тип запросов:

1. Зарегистрировать новый узел проверки

   - Запрос должен содержать идентификатор валидатора \(открытый ключ\)
   - Запрос должен быть подписан с приватным ключом валидатора
   - Сервис отбрасывает запрос, если подпись запроса не может быть проверена
   - Служба создает новый асимметричный ключ голосования для валидатора и возвращает публичный ключ в ответ
   - Если валидатор попытается зарегистрироваться снова, служба возвращает открытый ключ с существующей клавиатуры

2. Подписать голос

   - Запрос должен содержать транзакцию голосования и все данные проверки
   - Запрос должен быть подписан с приватным ключом валидатора
   - Сервис отбрасывает запрос, если подпись запроса не может быть проверена
   - Служба проверяет данные голосования
   - Служба возвращает подпись для транзакции

## Validator voting

Узел валидатора при запуске создает новую учетную запись голосования и регистрирует ее в кластере, представив новую транзакцию "Реестра голосов". Другие узлы в кластере обрабатывают эту транзакцию и включают новый валидатор в активном наборе. После этого валидатор отправляет транзакцию "нового голосования", подписанную с закрытым ключом валидатора при каждом голосовании.

### Конфигурация

Узел валидатора настроен с сетевой конечной точкой службы подписания \(IP/Port\).

### Регистрация

При запуске валидатор регистрируется с помощью сервиса подписей, используя JSON RPC. RPC вызов возвращает публичный ключ голосования для узла валидатора. Валидатор создает новую транзакцию "регистра голосов", включающую этот публичный ключ, и передает ее кластеру.

### Подборка голосования

За последний период голосования валидатор ищет голоса, представленные всеми узлами кластера. Эта информация передается в службу подписи с новым запросом на подписание голоса.

### Новая подпись голоса

Валидатор создает "новый голос" транзакцию и отправляет ее в службу подписания, используя JSON RPC. Запрос RPC также включает данные проверки голоса. При успешном завершении RPC-вызов возвращает подпись для голосования. При сбое RPC-вызов возвращает код ошибки.
