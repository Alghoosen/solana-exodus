---
title: Размещайте делегацию и награды
---

Стейкеры награждаются за помощь в проверке реестра. Они делают это путем делегирования своей доли в узлах валидатора. Эти валидаторы делают легенду воспроизведения книги и посылают голоса на голос за каждый узел, на который пользователи могут делегировать свои задачи. В остальной части кластера используются голоса, взвешенные для выбора блока при появлении форков. И валидатор, и стейкер нуждаются в некотором экономическом стимуле, чтобы играть свою роль. Валидатор должен быть компенсирован за его аппаратное обеспечение, и стейкер должен быть компенсирован риском получения его доли слэш. Экономика покрыта [наградами за разбиение](../implemented-proposals/staking-rewards.md). С другой стороны, этот раздел описывает лежащую в основе его применения механику.

## Базовый дизайн

Общая идея заключается в том, что валидатор владеет учетной записью для голосования. Аккаунт Vote отслеживает валидатор голосов, подсчитывает валидатор сгенерированные кредиты, и предоставляет любое дополнительное состояние валидатора. Аккаунт для голосования не знает ни одного делегированного ему пакета и не имеет веса для разметки.

Отдельная учетная запись для разбивки \(создана staker\) именует учетную запись для голосования, на которую будет делегирована ставка. Получаемые награды пропорциональны количеству lamports staked. Владельцем счета является только, что владеет только стейкер. Стейк на определенную долю lamports, хранящихся в этом аккаунте.

## Пассивная делегация

Любое число аккаунтов может делегировать на один счет голосования без интерактивных действий со стороны идентификатора, контролирующего учетную запись для голосования или представляющего голоса на счет.

Общая сумма, выделенная для голосового счета, может быть рассчитана на сумму всех аккаунтов, у которых есть ключ для голосового счета в качестве `StakeState::Stake::voter_pubkey`.

## Vote и Stake аккаунты

Процесс вознаграждения делится на две программы в рамках цепочки. Программа голосует за решение проблемы создания ставок на пластинке. Эта программа служит хранителем фонда вознаграждений и предусматривает пассивное делегирование. Stake program отвечает за выплату наград стейкеру и избирателю, когда показано, что делегат участвовал в утверждении книги.

### VoteState

Голосование - это текущее состояние всех голосов, которые подал в сеть валидатор. Голосование содержит следующую информацию о штате:

- `голос` - Структура данных голосов.
- `кредиты` - Общее количество вознаграждений, полученных этой программой голосования за всю жизнь.
- `root_slot` - Последний слот для полного блокирования необходим для вознаграждения.
- `комиссия` - комиссия, полученная этим штатом голосования, за вознаграждение, полученное от долей стейкеров. Это процентный потолок вознаграждения.
- Счет::lamports - накопившиеся lamports от комиссии. Они не учитываются в качестве стейков.
- `authorized_voter` - Только эта личность имеет право подавать голоса. Это поле может быть изменено только этим идентификатором.
- `node_pubkey` - Solana узел, голосующий в этой учетной записи.
- `authorized_withdrawer` - личность лица, ответственного за лампацию этой учетной записи, отделяют от адреса учетной записи и уполномоченного участника голосования.

### Инструкция голоса::Инициализация\(Голосование\)

- `аккаунт[0]` - RW - Голосование.

  `VoteInit` имеет новый голос `node_pubkey`, `authorized_voter`, `authorized_withdrawer`, и `комиссия`.

  другие состояния - участники голосования по необязательным обязательствам.

### Инструкция голоса::Authorize\(Pubkey, VoteAuthorize\)

Обновляет учетную запись с помощью нового авторизованного избирателя или снятия в соответствии с параметром \(`избиратель` или `Вывод средств`\). Транзакция должна быть подписана текущим `authorized_voter` или `authorized_withdrawer`.

- `аккаунт[0]` - RW - Голосование. `Дата голосования::authorized_voter` или `authorized_withdrawer` установлена на `Pubkey`.

### Инструкция голоса::Голос\(Голос\)

- `аккаунт[0]` - RW - Голосование. `Голосование::lockouts` и `Голосование::credits` обновлены в соответствии с правилами блокировки см. [Башня BFT](../implemented-proposals/tower-bft.md).
- `аккаунт[1]` - RO - `sysvar:slot_hashes` Список некоторых N самых последних ячеек и их хэшей для проверки правильности голосования.
- `аккаунт[2]` - RO - `sysvar::clock` Текущее сетевое время, выраженное в слотах, epochs.

### Состояние стейка

Стабильное состояние принимает одну из четырех форм, StakeState::Uninitialized, StakeState::Initialized, StakeState:::StakeState::RewardsPool. Только первые три формы используются в разбиении, но только StakeState::Stake интересно. Все вознаграждения создаются в генезисе.

### Состояние стейка::Стейк

StakeState::Stake — это текущее предпочтение делегации **staker** и содержит следующую информацию о состоянии:

- Аккаунт::lamports - Лампорты доступные для размещения.
- `Доля` - разбитое количество \(подвержено прогреву и откату\) для получения вознаграждения, всегда меньше или равно аккаунту::лампорты.
- `voter_pubkey` - Космический ключ экземпляра избирательного состояния, которому делегированы лампорты.
- `credits_observed` - Общее количество кредитов, востребованных за время существования программы.
- `активировал` - эпоха, на которой эта ставка была активирована/делегирована. Полная ставка будет засчитана после разогрева.
- `деактивировал` - эпоха, в которой эта ставка была деактивирована, Перед тем, как аккаунт будет полностью деактивирован, необходимо будет откатить несколько epochs, которые будут доступны для снятия.
- `authorized_staker` - публичный ключ сущности, которая подписывает делегирование, активацию и деактивацию транзакций.
- `authorized_withdrawer` - личность лица, ответственного за лампорты этой учетной записи, отделяют от адреса учетной записи и уполномоченного участника голосования.

### Состояние стейка::Награды

Во избежание одиночной блокировки или удержания в сети при выкупе 256 RewardsPools являются частью genesis под заранее определенными ключами, каждый из них::u64::MAX кредитов, чтобы иметь возможность удовлетворять выкупы в соответствии с номинальной стоимостью.

Разметки и RewardsPool - аккаунты, принадлежащие той же программе `Разбивка`.

### Инструкция для стейка::DelegateStake

Учетная запись разметки перемещена из инициализации в StakeState::Stake форма или из деактивированного (т.е. полностью cooled-down) StakeState::Stake to activated StakeState::Stake. Именно так разработчики выбирают учетную запись голосования и узел валидатора, на который делегированы их флажки аккаунта. Транзакция должна быть подписана `authorized_staker`.

- `Аккаунт[0]` - RW - экземпляр пикетажа::Разбиение пикета. `StakeState::Stake::credits_observed` инициализирован до `голоса::credits`, `StakeState::Stake::voter_pubkey` инициализирован в `аккаунт[1]`. Если это первоначальное делегирование доли, `StakeState::Stake::stake` инициализирован на баланс аккаунта в lamports, `Состояние StakeState::Stake::activated` инициализировано до текущей эпохи банка, и `Состояние StakeState::Stake::deactivated` инициализировано для установки::u64::MAX
- `аккаунт[1]` - Rw - Голосование.
- `аккаунт[2]` - R - sysvar::clock аккаунт, несет информацию о текущей epoch банка.
- `аккаунт[3]` - R - sysvar::stakehistory аккаунт, несет информацию о истории ставок.
- `аккаунт[4]` - R - ставка::Config аккаунт, несет подогрев, перезарядку и настройку слэш.

### Инструкция стейка::Authorize\(Pubkey, StakeAuthorize\)

Обновляет учетную запись с помощью нового авторизованного избирателя или снятия в соответствии с параметром \(`избиратель` или `Вывод средств`\). Транзакция должна быть подписана текущим `authorized_voter` или `authorized_withdrawer`. Должен истечь срок блокировки, или хранитель блокирования должен также подписать транзакцию.

- `аккаунт[0]` - RW - Голосование.

  `Дата голосования::authorized_voter` или `authorized_withdrawer` установлена на `Pubkey`.

### Инструкция для стейка::Deactivate

Стейкер может пожелать выйти из сети. Для этого сначала он должен деактивировать свою долю и ожидать перезарядки. Транзакция должна быть подписана `authorized_staker`.

- `аккаунт[0]` - RW - The StakeState::Stake Экземпляр, который деактивируется.
- `аккаунт[1]` - R - sysvar::clock из Банка, который несет текущий epoch.

Состояние разбивания::Stake::deactivated установлен на текущую эпоху + перезарядку. Для этого epoch ставка на счет будет равняться нулю, а счет:лампорты будут доступны для снятия.

### Инструкция стейка::Withdraw\(u64\)

С течением времени лампорты формируются в расчетном счете и все избытки сверх активированного достояния могут быть сняты. Транзакция должна быть подписана `authorized_staker`.

- `Счет[0]` - RW - Состояние стейка::Стейк, с которого нужно снять.
- `аккаунт[1]` - RW - аккаунт, на который должны быть зачислены снятые лампорты.
- `аккаунт[2]` - R - sysvar::clock из Банка, который несет текущий epoch.
- `аккаунт[3]` - R - sysvar::stake_history из Банка, который несет долю в истории прогрева/отката.

## Преимущества конструкции

- Одиночный голос для всех стейкеров.
- Для получения вознаграждения использование переменной кредита не обязательно.
- Каждая делегированная ставка может получить свою награду самостоятельно.
- Комиссия за работу сдается на хранение при получении вознаграждения от делегированной доли.

## Пример Callflow

![Пассивный стейкинг Callflow](/img/passive-staking-callflow.png)

## Награды

Здесь описаны конкретные механизмы и правила режима выплаты вознаграждений. Награды зачисляются делегированием игроку, который правильно голосует. Голосование неправильно обнаруживает, что ставки валидатора на [срыв](../proposals/slashing.md).

### Основы

Сеть выплачивает вознаграждения из части сети [инфляции](../terminology.md#inflation). Фиксировано количество лампортов за эпоху и должно быть разделено между всеми поставленными узлами в зависимости от их относительного веса и участия. Весовая единица называется [точкой](../terminology.md#point).

Награды за эпоху не доступны до конца этой эпохи.

В конце каждой эпохи, суммарное количество баллов, заработанных в эпоху, суммируется и используется для разделения части эпической инфляции в вознаграждении, приближающейся к баллам. Это значение записывается в банке в [sysvar](../terminology.md#sysvar), который сопоставляет эпохи с точками значений.

Во время выкупа ставка засчитывает заработанные очки на каждую эпоху, умножает на значение баллов эпохи, и переносит lamports в указанную сумму с счета вознаграждения на счет залога и голоса в соответствии с установкой комиссии по счету голосования.

### Экономика

Значение точки для эпохи зависит от агрегированного сетевого участия. Если участие в эпоху снижается, значения баллов выше для тех, кто принимает участие.

### Заработок кредитов

Валидаторы заработали один кредит за каждый правильный голос, превышающий максимальный лимит блокировки, т.е. Каждый раз, когда голос проверяющего игрока уходит из его списка блокировки, он делает голос корневым для узла.

Стейкеры, делегировавшие этому валидатору, получают баллы пропорционально их ставке. Заработанные баллы являются продуктом голосования кредитов и ставки.

### Cтейк подогрев, откат, вывод

Разумеется, после делегирования не вступают в силу немедленно. Они должны сначала пройти через период разогрева. В этот период часть ставки считается "эффективной", остальные считаются "активацией". Изменения происходят в эпохальных пределах.

Программа пакета ограничивает скорость изменения до общей доли сети, отражено в программе `config::warmup_rate` \(установлено в 25% за эпоху текущей реализации\).

Количество ставок, которые могут быть разогреты каждую эпоху, является функцией эффективной предыдущей эпохи, полная активация доли и настроенная скорость прогрева.

Перезарядка работает таким же образом. Как только стейк деактивируется, часть его считается "эффективным", а также "деактивацией". По мере того, как ставка приближается, она продолжает зарабатывать вознаграждения и подвергаться слэшированию, но и становится доступной для вывода.

Ставки на Bootstrap не подлежат разогреву.

Вознаграждение выплачивается против "эффективной" части ставки за эту эпоху.

#### Пример разогрева

Рассмотрение ситуации с единичной долей 1000 в эпоху N, с скоростью нагрева сети 20 %, а общая цена сети упала на 2000 в эпоху N.

В эпоху N+1 количество активируемого для сети составляет 400 \(20% от 2000\), а в эпоху N, этот пример ставки является единственным активом и поэтому имеет право на все доступные разогревы.

| эпоха | эффективность | активировано | итоговая эффективность | всего активировано |
|:----- | -------------:| ------------:| ----------------------:| ------------------:|
| N-1   |               |              |                  2,000 |                  0 |
| N     |             0 |        1,000 |                  2,000 |              1,000 |
| N+1   |           400 |          600 |                  2,400 |                600 |
| N+2   |           880 |          120 |                  2,880 |                120 |
| N+3   |          1000 |            0 |                  3,000 |                  0 |

Если есть 2 ставки \(X и Y\) для активации в epoch N, то им будет присуждена часть 20% пропорционально ставкам. В каждой эпохе эффективность и активация для каждого пакета является функцией предыдущего состояния эпохи.

| эпоха | X эфф | X акт | X эфф | X акт | итоговая эффективность | всего активировано |
|:----- | -----:| -----:| -----:| -----:| ----------------------:| ------------------:|
| N-1   |       |       |       |       |                  2,000 |                  0 |
| N     |     0 | 1,000 |     0 |   200 |                  2,000 |              1,200 |
| N+1   |   333 |   667 |    67 |   133 |                  2,400 |                800 |
| N+2   |   733 |   267 |   146 |    54 |                  2,880 |                321 |
| N+3   |  1000 |     0 |   200 |     0 |                  3,200 |                  0 |

### Вывод средств

В любое время могут быть сняты только амортизаторы сверх действующего и действующего амортизатора. Это означает, что во время прогрева никакие ставки не могут быть сняты. Во время восстановления все токены, превышающие реальную долю стали, могут быть сняты \(активация == 0\). Так как заработанные вознаграждения автоматически добавляются к ставке, вывод средств возможен только после деактивации.

### Блокировка

Стейк-счета поддерживают понятие блокировки, в котором остаток на ставке недоступен для снятия до определенного времени. Блокировка указывается как высота эпохи, т.е. минимальная высота эпихи, которая должна быть достигнута сетью до доступного для вывода баланса пикета, за исключением случаев, когда сделка также подписана указанным хранителем. Эта информация собирается при создании учетной записи, которая хранится в поле Lockup состояния этого аккаунта. Изменение авторизированного стиля или снятия также подлежит блокировке, так как такая операция является эффективным переводом.
