# RiP Curl: RPC с низкой задержкой, ориентированной на транзакции

## Проблематика

Первоначальная реализация Solana была создана для того, чтобы пользователей могли подтвердить транзакции, которые недавно были отправлены кластеру. Он был разработан с учетом использования памяти, так что любой валидатор должен иметь возможность поддерживать API, не беспокоясь о DoS-атаках.

Позже стало желательно использовать тот же API для поддержки проводника Solana. Первоначальный дизайн поддерживал только минуты истории, поэтому мы изменили его, чтобы вместо этого сохранять статусы транзакций в локальном экземпляре RocksDB и предлагать дни истории. Затем мы продлили это до 6 месяцев через BigTable.

С каждой модификацией API становился все более подходящим для приложений, обслуживающих статический контент, и менее привлекательным для обработки транзакций. Клиенты опрашивают статус транзакции вместо того, чтобы получать уведомления, создавая ложное впечатление о более длительном времени подтверждения. Более того, то, что клиенты могут опрашивать, ограничено, что не позволяет им принимать разумные решения в режиме реального времени, например, признание транзакции подтвержденной, как только конкретная, надежная валидаторы голосуют по нему.

## Предлагаемое решение

Веб-ориентированный на транзакции потоковый API, построенный на основе ReplayStage валидатора.

Улучшенный клиентский опыт:

* Поддержка подключений напрямую из приложений WebAssembly.
* Клиенты могут получать уведомления о ходе подтверждения в режиме реального времени, включая количество голосов и долю голосов избирателей.
* Клиенты могут быть уведомлены при изменении самого тяжелого форка, если это влияет на количество подтверждений транзакций.

Поддержка валидаторов:

* Каждый валидатор поддерживает некоторое количество одновременных подключений и в остальном не имеет значительных ограничений ресурсов.
* Статус транзакции никогда не сохраняется в памяти и не может быть опрошен.
* Подписи хранятся в памяти только до желаемого уровня приверженности или до истечения хэша блоков, что может случиться позже.

Как это работает:

1. Клиент подключается к валидатору, используя надежный канал связи, такой как веб-сокет.
2. Валидатор регистрирует подпись с помощью ReplayStage.
3. Валидатор отправляет транзакцию в Gulf Stream и повторяет все известные форки до тех пор, пока не истечет время хеширования блоков (не до тех пор, пока транзакция не будет завершена). принимается только на самой тяжёлом форке). Если время хеширования блоков истекает, подпись не регистрируется, клиент получает уведомление и соединение закрывается.
4. Когда ReplayStage обнаруживает события, влияющие на статус транзакции, он уведомляет клиента в режиме реального времени.
5. После подтверждения того, что транзакция внедрена (`CommitmentLevel::Max`), подпись отменяется, и сервер закрывает восходящий канал.
