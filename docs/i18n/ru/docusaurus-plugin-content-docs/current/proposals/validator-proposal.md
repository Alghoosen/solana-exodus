---
title: Валидатор
---

## История

Когда мы впервые запустили Solana, целью было снизить риски, связанные с заявками на TPS. Мы знали, что, несмотря на оптимистичный контроль параллелизма и достаточно длинные слоты лидеров, консенсус PoS не был самым большим риском для TPS. Это была проверка подписи на базе графического процессора, конвейерная обработка программного обеспечения и параллельный банкинг. Таким образом, родилась идея TPU (Transaction Processing Unit). После того, как мы превысили 100 тыс. TPS, мы разделили команду на одну группу, работающую над достижением 710 тыс. TPS, а другую - над раскрытием возможностей конвейера валидатора. Таким образом, родилась идея TVU (Transaction Validation Unit). Текущая архитектура является следствием постепенного развития с перечисленными этапами и приоритетами проекта. Это не отражение того, что мы когда-либо считали наиболее технически элегантным сечением этих технологий. В контексте ротации лидера четкое различие между обработкой (TPU) и проверкой (TVU) стирается.

## Различия между валидацией и лидерством

Фундаментальные различая между этими пайплайнами заключаются в присутствии PoH. В режиме лидера, мы обрабатываем транзакции, удаляем те, которые не проходят валидации и затем отмечаем конечный результат с помощью хэша PoH. В режиме валидатора мы проверяем этот хеш, очищаем его и обрабатываем транзакции точно так же способом. Единственное отличие состоит в том, что если валидатор видит транзакцию, не удовлетворяющую условиям, он не может просто взять и удалить ее, как это делает лидер, потому что это приведет к изменению хэша PoH. Вместо этого, отклоняется весь блок. Остальные отличия заключаются в том, что именно происходит _после_ банкинга. Лидер транслирует записи валидаторам, тогда как валидатор уже сделал это в RetransmitStage, что является оптимизацией времени подтверждения. Но с другой стороны, пайплайн работы валидатора требует ещё одного, последнего шага. Каждый раз, когда он завершает обработку блока, ему необходимо взвесить все наблюдаемые им форки, возможно проголосовать, и, если да, сбросить свой хэш PoH на хэше блока, за который он только что проголосовал.

## Предложенный дизайн

Мы разворачиваем множество уровней абстракции и строим единый пайплайн процессов, который может включать режим лидера всякий раз, когда идентификатор валидатора появляется в расписании лидеров.

![Диаграмма блоков валидатора](/img/validator-proposal.svg)

## Изменения

- FetchStage и BroadcastStage являются частью TPU
- BankForks переименован в Banktree
- TPU переходит на новый способо создания без сокетов под названием solana-tpu.
- BankingStage этап TPU поглощена ReplayStage
- TVU отброшен
- Новый этап RepairStage включает в себя Shred Fetch Stage и запрос на восстановление
- Сервис JSON RPC теперь опционален и используется для отладки. Вместо этого он должен быть частью отдельного исполняемого процесса `solana-blockstreamer`.
- Новый этап MulticastStage включает в себя часть ретрансляции и RetransmitStage
- MulticastStage транслируется в Blockstore
