---
title: Подтверждение блока
---

Валидатор голосует за хэш PoH для двух целей. Во-первых, голосование показывает, что, по его мнению, реестр действителен до этого момента. Во-вторых, так как действующих форков может существовать с заданной высотой, голосование также указывает на исключительную поддержку форка. Этот документ описывает только первые документы. Последний описан в [башне BFT](../implemented-proposals/tower-bft.md).

## Текущий дизайн

Чтобы начать голосование, валидатор сначала регистрирует аккаунт, на который будет отправлять свои голоса. Затем он отправляет голоса на этот счет. Голосование содержит высоту флага для блока, за который он голосует. В аккаунте хранятся 32 самых высоких высоты.

### Проблематика

- Только валидатор знает, как напрямую найти свои собственные голоса.

  Другие компоненты, такие как тот, который вычисляет время подтверждения, необходимо встроить в код валидатора. Код валидатора запрашивает у банка все счета, принадлежащие программе голосования.

- Бюллетени для голосования не содержат хеш-код PoH. Валидатор голосует только за то, что он заметил произвольный блок на некоторой высоте.

- Бюллетени для голосования не содержат хеша состояния банка. Без этого хэша нет свидетельств того, что валидатор выполнил транзакции и подтвердил отсутствие двойных расходов.

## Предложенный дизайн

### Первоначально нет состояния кросс-блока

В момент создания блока лидер должен добавить транзакцию NewBlock в реестр с количеством токенов, которые представляют собой вознаграждение за проверку. По сути, это инкрементная транзакция с несколькими подписями, которая отправляет токены из пула майнинга валидаторам. В учетной записи должно быть достаточно места для сбора голосов, необходимых для получения квалифицированного большинства. Когда валидатор наблюдает за транзакцией NewBlock, он имеет возможность отправить голосование, которое включает хэш состояния его реестра (состояние банка). Как только аккаунт наберет достаточно голосов, программа голосования должна распределить токены между валидаторами, что приведет к удалению аккаунта.

#### Время подтверждения регистрации

Банку необходимо будет знать о программе голосования. После каждой транзакции он должен проверять, является ли это транзакцией голосования, и если да, то проверять состояние аккаунта. Если сделка привела к получению сверхквалифицированного большинства, она должна записать время с момента отправки транзакции NewBlock.

### Окончание и выплаты

[ Tower BFT ](../implemented-proposals/tower-bft.md) - это предлагаемый алгоритм выбора форка. Предлагается отложить выплату майнерам до тех пор, пока _stack_ голосов валидаторов не достигнет определенной глубины, при которой откат не является экономически целесообразным. Таким образом, программу голосования может выполнять Tower BFT. Инструкции по голосованию должны ссылаться на глобальный аккаунт Tower, чтобы он мог отслеживать кросс-блочное состояние.

## Задачи

### Голосование по цепочке

Использование программ и аккаунтов для реализации этого немного утомительно. Самая трудная часть — это выяснить, сколько свободного места нужно выделить в NewBlock. Две переменные являются активным набором \_\_ и ставками этих валидаторов. Если мы посчитаем активное значение во время отправки NewBlock, то количество валидаторов для этого уже известно. Если, однако, мы разрешим новым валидаторам голосовать за старые блоки, нам понадобится способ динамического распределения пространства.

Аналогично духу, если лидер кэширует ставки во время NewBlock, программе голосования не нужно взаимодействовать с банком при обработке голосов. Если мы этого не сделаем, то у нас есть возможность разрешить колебания ставок до тех пор, пока не будет проведено голосование. Предположительно, валидатор может ссылаться на свой собственный счет для стекинга, но это будет текущая стоимость счета, а не стоимость счета последнего завершенного состояния банка. В настоящее время банк не предлагает возможности ссылаться на счета в определенные моменты времени.

### Последствия голосования для предыдущих блоков

Означает ли голосование по одной высоте голосование по всем блокам с более низкой высотой этого форка? Если это так, нам понадобится способ поиска аккаунтов всех блоков, которые еще не достигли супербольшинства. Если нет, валидатор может явно отправлять голоса всем блокам, чтобы получить вознаграждение за блок.
