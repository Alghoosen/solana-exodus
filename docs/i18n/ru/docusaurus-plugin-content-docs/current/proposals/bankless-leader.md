---
title: Лидер Безбанкового кредита
---

Безбанковый лидер делает минимальное количество работ для создания действующего блока. Лидеру поручено выполнять входящие транзакции, сортировать и фильтровать действительные транзакции, организовывать их в записи, измельчать записи и транслировать их. В то время как валидатору нужно только повторно собрать блок и воспроизвести выполнение правильно сформированных записей. Лидер выполняет в 3 раза больше операций с памятью перед выполнением любого банка, чем валидатор на обработанную транзакцию.

## Обоснование

Для нормальной работы банка необходимо выполнить 2 нагрузки и 2 магазина. С этим дизайнерским лидером просто 1 нагрузка. так что на 4x меньше account_db работа перед генерацией блока. Операции магазина, вероятно, будут дороже, чем чтение.

Когда этап воспроизведения начинает обработку тех же транзакций, он может предположить, что PoH действителен и что все записи безопасны для параллельного выполнения. Счета комиссий, которые были загружены для создания блока, вероятно, все еще находятся в памяти, поэтому дополнительная нагрузка должна быть теплой, а стоимость, вероятно, будет амортизирована.

## Комиссионный счет

[fee account](../terminology.md#fee_account)оплачивает транзакцию, которая будет включена в блок. Лидеру нужно только подтвердить, что у счета комиссии есть баланс для оплаты комиссии.

## Кэш баланса

На время последовательных блоков лидеров лидер поддерживает временный кэш баланса для всех обработанных счетов комиссий. Кэш - это карта ключей для лэмпортов.

В начале первого блока кеш баланса пуст. В конце последнего блока кэш удаляется.

Поиски в кэше баланса должны ссылаться на одну и ту же базовую вилку на протяжении всего времени кеширования. На границе блока кэш может быть сброшен вместе с базовым форком после того, как этап воспроизведения завершит проверку предыдущего блока.

## Проверка баланса

До проверки баланса лидер проверяет все подписи в транзакции.

1. Убедитесь, что аккаунты не используются, и BlockHash действителен.
2. Проверьте, присутствует ли аккаунт комиссии в кеше, или загрузите аккаунт из accounts_db и сохраните баланс лэмпорта в кеше.
3. Если баланс меньше, чем комиссия, удалите транзакцию.
4. Вычтите комиссию из баланса.
5. Для всех ключей в транзакции, которые являются кредитно-дебетовыми и на которые ссылается инструкция, уменьшите их баланс до 0 в кеше. Комиссия за счет декларируется как кредитно-дебетовая, но до тех пор, пока она не используется ни в одной инструкции, ее баланс не будет уменьшен до 0.

## Повторение Лидера

Лидеру нужно будет повторять свои блоки в рамках этапа, на котором будет выполняться обычная операция.

## Повтор лидера с последовательными блоками

Для лидера можно запланировать создание нескольких блоков подряд. В этом сценарии лидер, скорее всего, будет создавать следующий блок, в то время как воспроизводится этап воспроизведения первого блока.

Когда лидер завершает этап воспроизведения, он может сбросить кэш баланса, очистив его, и установить новую вилку в качестве основы для кеша, который может стать активным в следующем блоке.

## Восстановление кэша баланса

1. В начале блока, если кеш баланса не инициализирован, установите базовый форк для кеша баланса как родительский для блока и создайте пустой кеш.
2. если кеш инициализирован, проверьте, есть ли у родителей блока новый замороженный банк, который новее, чем текущий базовый форк для кеша баланса.
3. если существует родительский элемент, более новый, чем базовый форк кеша, сбросить кеш на родительский.

## Влияние на клиентов

Один и тот же комиссионный счет может быть использован много раз в одном блоке до тех пор, пока он не будет использован как кредит - дебит с помощью инструкции.

Клиенты, которые передают большое количество транзакций в секунду, должны использовать специальный счет для комиссии, который не используется в качестве кредитно-дебетовой ни в одной инструкции.

Как только плата за счет используется в качестве кредитно-дебетовой, проверка баланса не будет выполнена до тех пор, пока кэш баланса не будет сброшен.
