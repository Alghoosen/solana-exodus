---
title: Проверка межсетевых транзакций
---

## Проблематика

Межсетевые приложения не новы для экосистемы цифровых активов; Фактически, даже небольшие централизованные биржи по-прежнему категорически превосходят все приложения с единой цепью, вместе взятые, с точки зрения пользователей и объема. Они имеют огромные оценки и потратили годы на эффективную оптимизацию своих основных продуктов для широкого круга конечных пользователей. Однако их основные операции сосредоточены вокруг механизмов, которые требуют от пользователей одностороннего доверия им, как правило, практически без каких-либо средств правовой защиты или защиты от случайной потери. Это привело к расколу более широкой экосистемы цифровых активов по сетевым линиям, поскольку обычно решения для обеспечения взаимодействия:

- Технически сложно полностью реализовать
- Создание нестабильных структур стимулирования масштаба сети
- Требовать последовательного и высокого уровня сотрудничества между заинтересованными сторонами

## Предлагаемое решение

Простая проверка платежей \ (SPV \) - это общий термин для ряда различных методологий, используемых легкими клиентами в большинстве крупных сетей блокчейнов для проверки аспектов состояния сети без бремени полного хранения и обслуживания самой цепочки. В большинстве случаев это означает использование некоторой формы хеш-дерева для предоставления доказательства наличия данной транзакции в определенном блоке путем сравнения с корневым хешем в заголовке этого блока или его эквивалентом. Это позволяет легкому клиенту или кошельку самостоятельно достичь вероятностного уровня уверенности в событиях в цепочке с минимальным уровнем доверия, требуемым в отношении сетевых узлов.

Традиционно процесс сборки и проверки этих доказательств выполняется вне сети узлами, кошельками или другими клиентами, но он также предлагает потенциальный механизм для межцепочечной проверки состояния. Однако, переместив возможность проверки доказательств SPV в цепочку в виде смарт-контракта с одновременным использованием архивных свойств, присущих цепочке блоков, можно создать систему для программного обнаружения и проверки транзакций в других сетях без участия каких-либо типов доверенный оракул или сложный многоступенчатый механизм консенсуса. Эта концепция может быть широко распространена на любую сеть с механизмом SPV и даже может работать на двусторонней основе на других платформах смарт-контрактов, открывая возможность дешевой, быстрой межцепочечной передачи стоимости без использования залога, хэш-блоков или доверенных посредников.

Использование преимуществ хорошо отработанных и стабильных в развитии механизмов, уже общих для всех основных блокчейнов, позволяет решениям взаимодействия на основе SPV быть значительно проще, чем согласованные многоэтапные подходы. Как часть этого, они избавляются от необходимости в широко согласованных стандартах межсетевой связи и от крупных многосторонних организаций, которые пишут их в пользу набора дискретных контрактных услуг, которые могут быть легко использованы с помощью контрактов вызывающих абонентов через общие формат абстракции. Это заложит основу для широкого спектра приложений и контрактов, способных взаимодействовать в рамках разнообразной и каждой растущей экосистемы платформ.

## Терминология

SPV Program (Программа SPV) - клиентский интерфейс для межцепочечной системы SPV, управляет ролями участников. SPV Engine(Движок SPV) - проверяет доказательства транзакций, часть программы SPV. Client - вызывающий абонент программы SPV, обычно другой контракт Solana. Prover - Сторона, которая генерирует доказательства транзакций и отправляет их в программу SPV. Transaction Proof(Подтверждение транзакции) - создано Provers, содержит ссылку на доказательство Меркла, транзакцию и заголовок блока. Merkle Proof(Подтверждение Меркла) - базовое доказательство SPV, которое проверяет наличие транзакции в определенном блоке. Block Header (Заголовок блока) - представляет основные параметры и относительное положение данного блока. Proof Request(Запрос подтверждения) - заказ, размещенный клиентом для проверки транзакции \ (s \) проверяющими. Header Store(Хранилище заголовков) - структура данных для хранения и ссылки на диапазоны заголовков блоков в доказательствах. Client Request(Клиентский запрос) - транзакция от клиента к программе SPV для инициирования создания запроса подтверждения. Sub-account (Дополнительный аккаунт) - аккаунт Solana, принадлежащая другому контракту аккаунта, без собственного приватного ключа.

## Сервис

Программы SPV выполняются как контракты, развернутые в сети Solana, и поддерживают своего рода общедоступную торговую площадку для доказательств SPV, которая позволяет любой стороне подавать как запросы доказательств, так и сами доказательства для проверки в ответ на запросы. В любой момент времени будет активным несколько экземпляров программы SPV, по крайней мере, по одному для каждой подключенной внешней сети и, возможно, несколько экземпляров в каждой сети. Экземпляры программ SPV будут относительно согласованы в своем высокоуровневом API и наборах функций с некоторыми вариациями между валютными платформами \ (Bitcoin, Litecoin\) и платформами смарт-контрактов из-за возможности проверки изменений состояния сети, помимо простых транзакций. In every case regardless of network, the SPV Program relies on an internal component called an SPV engine to provide stateless verification of the actual SPV proofs upon which the higher level client facing features and api are built. Механизм SPV требует реализации для конкретной сети, но позволяет легко расширять более крупную межцепочечную экосистему любой командой, которая решит реализовать эту реализацию и включить ее в стандартную программу SPV для развертывания.

Для целей запросов на подтверждение запрашивающая сторона называется клиентом программы, который в большинстве, если не во всех случаях, будет другим контрактом Solana. Клиент может выбрать отправку запроса, относящегося к конкретной транзакции, или включение более широкого фильтра, который может применяться к любому из диапазона параметров транзакции, включая ее входы, выходы и сумму. Например, клиент может отправить запрос на любую транзакцию, отправленную с данного адреса A на адрес B, с суммой X через определенное время. Эта структура может использоваться в ряде приложений, таких как проверка конкретного предполагаемого платежа в случае атомарного свопа или обнаружение движения залоговых активов по ссуде.

После отправки клиентского запроса, при условии, что он успешно проверен, программа SPV создает учетную запись запроса подтверждения для отслеживания хода выполнения запроса. Проверяющие используют аккаунт, чтобы указать запрос, который они намереваются заполнить в доказательствах, которые они отправляют для проверки, после чего программа SPV проверяет эти доказательства и в случае успеха сохраняет их в аккаунта данных аккаунта запроса. Клиенты могут отслеживать статус своих запросов и видеть любые применимые транзакции вместе со своими доказательствами, запрашивая данные аккаунта аккаунта запроса. В будущих итерациях, когда будет поддерживаться Solana, этот процесс будет упрощен за счет публикации событий контрактами, вместо того, чтобы требовать процесса стиля опроса, как описано.

## Реализация

Механизм Solana Inter-chain SPV состоит из следующих компонентов и участников:

### Движок SPV

Контракт, развернутый на Solana, который без сохранения состояния проверяет доказательства SPV для вызывающего. В качестве аргументов для проверки он принимает:

- Подтверждение SPV в правильном формате блокчейна, связанного с программой
- Ссылка \ (s \) на соответствующие заголовки блоков, чтобы сравнить это подтверждение с
- Необходимые параметры транзакции для проверки

  Если рассматриваемое доказательство успешно подтверждено, программа SPV сохраняет доказательство

  этой проверки в аккаунт запроса, которая может быть сохранена вызывающим абонентом в

  данные своего аккаунта или обрабатываются иным образом по мере необходимости. SPV программы также раскрывают

  утилиты и структуры, используемые для представления и проверки заголовков,

  транзакции, хэши и т. д. по цепочке.

### SPV программа

Контракт, развернутый на Solana, который координирует и обеспечивает взаимодействие между Клиентами и Проверяющими, а также управляет проверкой запросов, заголовков, доказательств и т. д. Это основная точка доступа для клиентских контрактов к межцепочечной сети. Механизм SPV. Он предлагает следующие основные возможности:

- Отправить запрос подтверждения - позволяет клиенту разместить запрос на конкретное доказательство или набор доказательств
- Отменить запрос подтверждения - позволяет клиенту признать недействительным ожидающий запрос
- Заполнить запрос подтверждения - используется Доказывающими для подачи на проверку доказательства, соответствующего данному запросу подтверждения

  Программа SPV поддерживает общедоступный список действительных ожидающих подтверждения

  Запрашивает данные своего аккаунта в пользу Проверяющих, которые его отслеживают и

  прилагайте ссылки на целевые запросы к поданным доказательствам.

### Подтверждение запроса

Сообщение, отправленное Клиентом механизму SPV, обозначающее запрос на подтверждение конкретной транзакции или набора транзакций. Запросы на подтверждение могут либо вручную указать определенную транзакцию по ее хешу, либо выбрать отправку фильтра, который соответствует нескольким транзакциям или классам транзакций. Например, фильтр, соответствующий «любая транзакция с адреса xxx на адрес yyy», может использоваться для обнаружения выплаты долга или урегулирования межцепочечного свопа. Аналогичным образом, фильтр, соответствующий «любой транзакции с адреса xxx», может использоваться в контракте на кредитование или добычу синтетических токенов для отслеживания и реагирования на изменения в обеспечении. Запросы на подтверждение отправляются с оплатой, которая выплачивается по контракту с механизмом SPV соответствующему проверу после подтверждения соответствия этого запроса.

### Запросить книгу

Публичный список действительных открытых запросов на подтверждение, доступных доказывающим сторонам для заполнения или клиентам для отмены. Примерно аналогично книге заказов на бирже, но с одним типом листинга, а не с двумя отдельными сторонами. Он хранится в аккаунте данных программы SPV.

### Подтверждение

Подтверждение наличия данной транзакции в данном блокчейне. Подтверждение охватывают как фактическое доказательство Меркла, так и ссылку \ (s \) на цепочку допустимых последовательных заголовков блоков. Они создаются и отправляются проверяющими в соответствии со спецификациями общедоступных запросов на подтверждение, размещенных в книге запросов программой SPV. После проверки они сохраняются в данных аккаунта соответствующего запроса подтверждения, которые могут использоваться Клиентом для отслеживания состояния запроса.

### Клиент

Отправитель запроса на подтверждение транзакции. Клиентами чаще всего будут другие контракты как части приложений или определенных финансовых продуктов, таких как ссуды, свопы, условное депонирование и т. д. Клиент в любом заданном цикле процесса проверки первоначально отправляет ClientRequest, который сообщает параметры и плату, и в случае успешной проверки приводит к созданию аккаунта Proof Request программой SPV. Клиент также может подать CancelRequest со ссылкой на активный запрос подтверждения, чтобы обозначить его как недействительный для целей представления доказательств.

### Проверяющий

Податель доказательства, заполняющий запрос на подтверждение. Проверящие отслеживают книгу запросов программы SPV на предмет невыполненных запросов на подтверждение и генерируют соответствующие доказательства, которые они отправляют программе SPV для проверки. Если доказательство принято, то оплата, связанная с соответствующим подтверждением запроса, выплачивается Проверяющему. Проверящие обычно работают как узлы Solana Blockstream, которые также имеют доступ к узлу Bitcoin, который они используют для построения доказательств и доступа к заголовкам блоков.

### Заголовок блока

Структура данных на основе аккаунта, используемая для поддержки заголовков блоков с целью включения в представленные доказательства путем ссылки на аккаунт хранилища заголовков. хранилища заголовков могут поддерживаться независимыми объектами, поскольку проверка цепочки заголовков является компонентом механизма проверки подтверждения программы SPV. Сборы, которые выплачиваются проверяющими с помощью запросов на подтверждение, делятся между отправителем самого доказательства Меркла и хранилищем заголовков, на которое имеется ссылка в представленном доказательстве. Из-за текущей неспособности увеличить уже выделенную емкость данных аккаунта, вариант использования требует структуры данных, которая может расти бесконечно без перебалансировки. Субаккаунты - это аккаунты, принадлежащие программе SPV без собственных приватных ключей, которые используются для хранения путем выделения заголовков блоков для данных их аккаунтов. Возможны многочисленные потенциальные подходы к реализации системы заголовков:

Хранить заголовки в субсчетах программы, проиндексированных по публичному адресу:

- Каждый субаккаунт содержит один заголовок и имеет публичный ключ, соответствующий блокхэшу
- Требуется такое же количество поисков данных аккаунта как и подтверждения на верификацию
- Ограничение на количество подтверждений \ (15-20 \) через максимальный лимит данных транзакции
- Отсутствие дублирования отдельных заголовков по всей сети

Связанный список нескольких субсчетов, хранящих заголовки:

- Поддерживать последовательный индекс аккаунта хранения, много заголовков на аккаунт хранения
- Не более 2 запросов к данным аккаунта для & gt; 99,9% проверок \ (1 для большинства \)
- Компактный последовательный формат адреса данных позволяет любое количество подтверждений и быстрого поиска
- Снижает эффективность дублирования заголовков в масштабе всей сети
