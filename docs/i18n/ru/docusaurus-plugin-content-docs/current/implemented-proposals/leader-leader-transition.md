---
title: Смена лидера
---

Тут описана реализациz передачи между лидерами права генерации PoH реестра, поскольку каждый лидер генерирует свой собственный слот.

## Вызовы

Текущий и следующий лидер находятся в состоянии гонки, генерируя последний тик для текущего слота. Лидер может смениться и попасть на этот слот, продолжая обрабатывать записи, сделанные прошлым лидером.

Если бы следующий лидер мог бы сформировать свой собственный слот сразу после того, как он проголосовал за текущего - это было бы идеальным сценарием. Весьма вероятно, что следующий лидер достигнет высоты своего слота PoH до того, как текущий лидер завершит трансляцию всего блока.

Следующий лидер должен принять решение: присоединить свой собственный блок к последнему завершенному блоку или дождаться завершения текущего блока. Возможно, что следующий лидер создаст блок, предполагающий, что текущий лидер потерпел неудачу, даже если остальная часть сети наблюдает, что этот блок был успешным.

У нынешнего лидера есть стимулы как можно раньше начать свой слот, чтобы получить экономические выгоды. Эти стимулы должны быть сбалансированы необходимостью лидера присоединить свой блок к блоку, который имеет наибольшую подтврежденность со стороны остальной сети.

## Таймаут лидера

Пока лидер принимает записи для предыдущего слота, он может отложить рассылку начала своего блока в реальном времени - сделать таймаут. Задержка настраивается локально каждым лидером и может динамически зависеть от поведения предыдущего лидера. Если блок предыдущего лидера подтверждается TVU(Transaction Validation Unit) лидера до тайм-аута, PoH сбрасывается до начала слота, и этот лидер немедленно создает свой собственный блок.

Минусы:

- Лидер откладывает свой собственный слот, потенциально давая следующему лидеру больше времени,

  чтобы наверстать упущенное.

Плюсы:

- Все пространство в блоке используется для записей.
- Таймаут не фиксирован.
- Таймаут является локальным для лидера, поэтому может быть разумно сбалансированным. Лидер может принимать во внимание производительность передачи пакетов посредством Turbine.
- Такая архитектура не требует форка реестра для обновления.
- Предыдущий лидер может с избыточностью передать последнюю запись в блоке следующему лидеру, а следующий может предположительно решить довериться ему и сгенерировать этот блок без проверки предыдущего.
- Лидер может спекулятивно сгенерировать последний тик из последней полученной записи.
- Лидер может спекулятивно обрабатывать транзакции и угадать, какие из них не будут кодироваться предыдущим лидером. Это также можно считать вектором для атаки цензурой. Текущий лидер может удерживать получаемые от клиентов транзакции, чтобы включить их в свой собственный слот. После обработки записи можно быстро воспроизвести в PoH.

## Альтернативные варианты

### Защищенный тик в конце слота

Лидер не производит записи в своем блоке после _предпоследнего тика_, который является последним тиком перед следующим слотом. Сеть голосует за _последний тик_, так что разница во времени между _предпоследним тиком_ и _последним_ является принудительным таймаутом для всей сети, также как и для следующего лидера перед тем, как новый слот можно будет создать. Сеть сможет произвести _последний тик_ на основе _предпоследнего_.

Если следующий лидер получает _предпоследний тик_ до того, как он создаст свой собственный _первый тик_ в слоте, он сбросит свой PoH и создаст _первый тик_ на основе _предпоследнего тика_ от предыдущего лидера. Остальные участники сети также сбросят свои PoH, чтобы произвести _последний тик_ в качестве id для голосования.

Минусы:

- Каждое голосование, а следовательно и его подтверждение, откладываются на фиксированное время. На 1 тик, или приблизительно на 100ms.
- Среднее время подтверждения транзакций будет минимум на 50ms больше.
- Так как эта часть является образующей для реестра, потребуется хард-форк, чтобы изменить такое поведение.
- Не всё пространство в блоке будет использовано для записей.

Плюсы в сравнении с индивидуальным таймаутом лидера:

- Следующий лидер получает все предыдущие записи, поэтому он может начать обработку транзакций, не записывая их в PoH.
- Предыдущий лидер, может явно передать последнюю запись, содержащую _предпоследний тик_, следующему лидеру. Следующий лидер может спекулятивно сгенерировать _последний тик_ так скоро, как только получит _предпоследний тик_, даже перед его верификацией.
