---
title: Аренда
---

Аккаунты в Solana могут иметь контролируемое владельцем состояние \ (`Account:: data` \), которое отличается от баланса аккаунта \ (`Account:: lamports` \). Поскольку валидаторам в сети необходимо поддерживать рабочую копию этого состояния в памяти, сеть взимает плату за потребление этого ресурса, основанную на времени и пространстве, также известную как аренда.

## Двухуровневый режим аренды

Счета, на которых поддерживается минимальный остаток, эквивалентный 2 годам арендной платы, не облагаются. _2 years_ основан на том факте, что стоимость оборудования снижается на 50% каждые 2 года, и результирующей сходимости из-за того, что это геометрический ряд. Со счетов, баланс которых ниже этого порога, взимается арендная плата по ставке, указанной в генезисе, в лампортах за байт-год. Сеть взимает арендную плату за каждую эпоху в кредит на следующую эпоху, а `Account:: rent_epoch` отслеживает следующий раз, когда арендная плата должна быть снята со счета.

В настоящее время стоимость аренды фиксирована на генезисе. Однако ожидается, что он будет динамичным, отражая стоимость базового оборудования для хранения данных в то время. Таким образом, обычно ожидается, что цена будет снижаться по мере снижения стоимости оборудования по мере развития технологий.

## Сроки сбора аренды

Существует два времени сбора ренты со счетов: \ (1 \) при ссылке на транзакцию, \ (2 \) периодически, один раз в эпоху. \ (1 \) включает транзакцию для создания самой нового аккаунта, и это происходит во время обычной обработки транзакции банком как часть фазы загрузки. \ (2 \) существует, чтобы гарантировать сбор ренты с устаревших счетов, на которые вообще не ссылаются в последние эпохи. \ (2 \) требует полного сканирования аккаунтов и распространяется на эпоху на основе префикса адреса аккаунта, чтобы избежать скачков нагрузки из-за этого сбора арендной платы.

Напротив, сбор арендной платы не применяется к счетам, которые напрямую управляются какими-либо бухгалтерскими процессами на уровне протокола, включая:

- Распределение самого сбора ренты (в противном случае это может вызвать рекурсивную обработку сбора ренты)
- Распределение вознаграждений за стекинг в начале каждой эпохи (чтобы уменьшить всплеск обработки в начале новой эпохи)
- Распределение комиссии за транзакцию в конце каждого слота

Даже если эти процессы выходят за рамки сбора ренты, все управляемые аккаунты в конечном итоге будут обрабатываться с помощью механизма \ (2 \).

## Фактическая обработка взыскания ренты

Арендная плата взимается за одну эпоху, и аккаунты имеют `Account:: rent_epoch`, равный `current_epoch` или `current_epoch + 1` в зависимости от режима аренды.

Если аккаунт находится в освобожденном режиме, `Account:: rent_epoch` просто обновляется до `current_epoch`.

Если аккаунт не освобождена от налогов, разница между следующей эпохой и `Account:: rent_epoch` используется для расчета суммы арендной платы, причитающейся с этого аккаунта \ (через `Rent:: due ()` \). Любые дробные лэмпорты вычисления усекаются. Причитающаяся арендная плата вычитается из `Account:: lamports`, а `Account:: rent_epoch` обновляется до `current_epoch + 1` (= следующая эпоха). Если сумма арендной платы меньше одного лэмпорта, изменения в счет не вносятся.

Аккаунты на балансе которых недостаточно для погашения причитающейся арендной платы, просто не загружаются.

Процент собранной аренды уничтожается. Остальные распределяются между аккаунтами валидатора по весу, сбору за транзакцию в конце каждого слота.

Наконец, сбор арендной платы происходит в соответствии с обновлениями аккаунта на уровне протокола, такими как распределение арендной платы между валидаторами, что означает отсутствие соответствующей транзакции для удержаний арендной платы. Таким образом, сбор арендной платы является довольно невидимым, только неявно наблюдаемым по недавней транзакции или заранее определенному времени с учетом префикса адреса учетной записи.

## Соображения в дизайне

### Обоснование текущего дизайна

В соответствии с предыдущим планом НЕ возможно иметь аккаунты, которые остаются, никогда не касаются и никогда не должны платить арендную плату. Accounts always pay rent exactly once for each epoch, except rent-exempt, sysvar and executable accounts.

This is an intended design choice. Otherwise, it would be possible to trigger unauthorized rent collection with `Noop` instruction by anyone who may unfairly profit from the rent (a leader at the moment) or save the rent given anticipated fluctuating rent cost.

As another side-effect of this choice, also note that this periodic rent collection effectively forces validators not to store stale accounts into a cold storage optimistically and save the storage cost, which is unfavorable for account owners and may cause transactions on them to stall longer than others. On the flip side, this prevents malicious users from creating significant numbers of garbage accounts, burdening validators.

As the overall consequence of this design, all accounts are stored equally as a validator's working set with the same performance characteristics, reflecting the uniform rent pricing structure.

### Ad-hoc коллекция

Рассматривался вопрос о сборе арендной платы по мере необходимости \ (т.е. всякий раз, когда счета были загружены / открыты \). К числу вопросов, связанных с таким подходом, относятся:

- аккаунты загруженные как «только кредит» для транзакции, вполне разумно предполагать, что они будут иметь причитающуюся арендную плату

  но не будет доступен для записи во время любой такой транзакции

- желателен механизм "выбить кусты" \ (то есть найти аккаунты, за которые нужно платить за аренду \),

  чтобы аккаунты, которые загружаются нечасто, не получили бесплатную поездку

### Системная инструкция по сбору ренты

Рассматривался вопрос о сборе ренты с помощью системной инструкции, поскольку он, естественно, распределял ренту между активными узлами и узлами, взвешенными по ставкам, и мог производиться постепенно. Тем не менее:

- это оказало бы неблагоприятное воздействие на пропускную способность сети
- для этого потребуется специальный регистр во время выполнения, так как аккаунты с владельцами, не принадлежащими к SystemProgram, могут быть списаны этой инструкцией
- кто-то должен будет оформить транзакции
