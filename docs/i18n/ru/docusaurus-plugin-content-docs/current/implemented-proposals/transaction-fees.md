---
title: Детерминированные комиссии за транзакции
---

На текущий момент транзакции включают в себя поле комиссий, которое указывает на поле максимальную комиссию, изымаемую лидером слота за обработку транзакции. Кластер же соглашается на минимальную плату. Если сеть перегружена, лидер слота может отдать приоритет транзакциям, предлагающим более высокие комиссии. Это означает, что клиент не будет знать, сколько было собрано, до тех пор пока транзакция не будет подтверждена кластером и не будет проверен остаток баланса. И это попахивает именно тем, что нам не очень нравится, когда мы говорим о газе в сети Ethereum - отсутствием детерминизма.

## Комиссии зависимые от нагрузки

Каждый валидатор использует _подпись для каждого слота_ \(SPS или signatures per slot\) для оценки перегрузки сети и _цель SPS_, чтобы оценить требуемую вычислительную мощность кластера. Валидатор узнает о цели SPS c генезис-конфигураций, тогда как сам SPS вычисляется с недавно обработанных транзакций. Генезис-конфигурация также определяет цель для `lamports_per_signature`, что является комиссией за подпись, когда кластер обрабатывает _цель SPS_.

## Расчет комиссии

Для запроса текущих параметров комиссий кластера, клиент может использовать JSON RPC API. Эти параметры помечаются хешем блока (blockhash) и остаются валидными до тех пор, пока этот хэш не станет достаточно старым, чтобы его отклонил лидер слота.

Перед отправкой полной транзакции в кластер, клиент может отправить данные транзакции и размер комиссий в модуль SDK, который называется _калькулятором комиссий_. Пока версия SDK клиента совпадает с версией лидера слота, клиент может быть уверен, что его аккаунт изменится точно на тоже количество лэмпортов, которое возвращается калькулятором.

## Параметры комиссии

При первой реализации этой архитектуры, только `lamports_per_signature` был единственным параметром определяющим комиссию. Чем больше подписей должен проверить кластер, тем выше собираемые комиссии. Точное количество лэмпортов определяется отношением SPS к цели SPS. В конце каждого слота, кластер понижает `lamports_per_signature`, если SPS ниже цели и повышает, если он выше. Минимальное значение для `lamports_per_signature` - 50% от целевого значения `lamports_per_signature` и максимальное значение равно 10x от целевого lamports_per_signature

Будущие параметры могут включать:

- `lamports_per_pubkey` - цена загрузки аккаунта
- `lamports_per_slot_distance` - более высокая цена, для загрузки очень старого аккаунта
- `lamports_per_byte` - цена за размер загружаемого аккаунта
- `lamports_per_bpf_instruction` - цена запуска программы

## Атаки

### Взлом цели SPS

Группа валидаторов может pf[dfnbnm кластер, если они смогут убедить его поднять цель SPS выше точки, за которой остальные валидаторы могут продолжать работу. Повышение целевого показателя вызовет снижение комиссий, что, по-видимому, приведет к увеличению спроса и, следовательно, к увеличению TPS. Если у валидатора нет оборудования, которое может настолько быстро обрабатывать такое количество транзакций, его голоса подтверждения в конечном станут занимать так много времени, что кластер будет вынужден отключить его.
