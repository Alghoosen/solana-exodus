# RiP Curl : 저 지연, 트랜잭션 지향 RPC

## 문제

Solana의 초기 RPC 구현은 사용자가 최근에 클러스터로 전송 된 트랜잭션을 확인할 수 있도록하기 위해 만들어졌습니다. 모든 유효성 검사기가 DoS 공격에 대한 걱정없이 API를 지원할 수 있도록 메모리 사용량을 염두에두고 설계되었습니다.

나중에 동일한 API를 사용하여 Solana 탐색기를 지원하는 것이 바람직해졌습니다. 원래 디자인은 몇 분의 기록 만 지원했기 때문에 트랜잭션 상태를 로컬 RocksDB 인스턴스에 저장하고 며칠 동안의 기록을 제공하도록 변경했습니다. 그런 다음 BigTable을 통해 6 개월로 연장했습니다.

수정할 때마다 API는 정적 콘텐츠를 제공하는 애플리케이션에 더 적합하고 트랜잭션 처리에는 덜 매력적이되었습니다. 클라이언트는 알림을받는 대신 트랜잭션 상태를 폴링하여 확인 시간이 더 길다는 잘못된 인상을줍니다. 또한 클라이언트가 폴링 할 수있는 항목이 제한되어있어 특정 신뢰할 수있는 밸리데이터이 투표하자마자 트랜잭션을 인식하는 것과 같은 합리적인 실시간 결정을 내리는 것을 방지 할 수 있습니다.

## 제안 된 해법

유효성 검사기의 ReplayStage를 기반으로 구축 된 웹 친화적 인 트랜잭션 지향 스트리밍 API입니다.

향상된 클라이언트 경험 :

* WebAssembly 앱에서 직접 연결을 지원합니다.
* 고객은 투표 및 유권자 지분 가중치를 포함한 확인 진행 상황을 실시간으로 알 수 있습니다.
* 거래 확인 횟수에 영향을 미치는 경우 가장 무거운 포크가 변경 될 때 고객에게 알림을 보낼 수 있습니다.

밸리데이터이 다음을 더 쉽게 지원할 수 있습니다.

* 각 유효성 검사기는 일부 동시 연결을 지원하며 그렇지 않은 경우 중요한 리소스 제약이 없습니다.
* 트랜잭션 상태는 메모리에 저장되지 않으며 폴링 할 수 없습니다.
* 서명은 원하는 커밋 레벨 또는 블록 해시가 만료 될 때까지만 메모리에 저장됩니다.

작동 원리 :

1. 클라이언트는 웹 소켓과 같은 신뢰할 수있는 통신 채널을 사용하여 유효성 검사기에 연결합니다.
2. 유효성 검사기가 ReplayStage에 서명을 등록합니다.
3. 밸리데이터는 트랜잭션을 걸프 스트림으로 보내고 블록 해시가 만료 될 때까지 알려진 모든 포크를 재 시도합니다 (트랜잭션이 가장 무거운 포크에서만 수락 될 때까지는 아님). 블록 해시가 만료되면 서명이 등록 취소되고 클라이언트에 알림이 전송되며 연결이 종료됩니다.
4. ReplayStage는 트랜잭션 상태에 영향을 미치는 이벤트를 감지하여 실시간으로 클라이언트에 알립니다.
5. 트랜잭션이 루팅되었음을 확인한 후 (`CommitmentLevel :: Max`) 서명이 등록 취소되고 서버가 업스트림 채널을 닫습니다.ㄴ
