---
title: Gossip Service
---

Gossip Service는 컨트롤 플레인의 노드에 대한 게이트웨이 역할을합니다. 유효성 검사기는 서비스를 사용하여 클러스터의 다른 모든 노드에서 정보를 사용할 수 있는지 확인합니다. 이 서비스는 가십 프로토콜을 사용하여 정보를 브로드 캐스트합니다.

## 가십 개요

노드는 클러스터를 관리하기 위해 서로간에 서명 된 데이터 개체를 지속적으로 공유합니다. 예를 들어, 그들은 연락처 정보, 원장 높이 및 투표를 공유합니다.

1/10 초마다 각 노드는 "push"메시지 및 / 또는 "pull"메시지를 보냅니다. 푸시 및 풀 메시지는 응답을 유도 할 수 있으며 푸시 메시지는 클러스터의 다른 사용자에게 전달 될 수 있습니다.

Gossip은 잘 알려진 UDP / IP 포트 또는 잘 알려진 범위의 포트에서 실행됩니다. 클러스터가 부트 스트랩되면 노드는 가십 엔드 포인트 \ (소켓 주소 \)를 찾을 수있는 위치를 서로 알립니다.

## 가십 레코드레코드

가십을 통해 공유되는는 임의적이지만,이를 수신하는 노드가 이해할 수 있도록 필요에 따라 서명 및 버전이 \ (타임스탬프 포함 \)됩니다. 노드가 동일한 소스에서 두 개의 레코드를 수신하면 가장 최근의 타임스탬프가있는 레코드로 자체 사본을 업데이트합니다.

## 가십 서비스 인터페이스

### Push Message

노드는 공유 할 정보가 있음을 클러스터에 알리기 위해 푸시 메시지를 보냅니다. 노드는 푸시 메시지를`PUSH_FANOUT` 푸시 피어로 보냅니다.

푸시 메시지를 수신하면 노드는 다음 메시지를 검사합니다.

1. 중복 : 메시지가 이전에 본 적이있는 경우 노드는 메시지를 삭제하고 하위 스테이킹 노드에서 전달되면`PushMessagePrune`로 응답 할 수 있습니다 .
2. 새 데이터 : if 메시지가 노드에 새로 추가되었습니다

   - .-클러스터 정보에 업데이트 된 버전이있는 새 정보를 저장하고

     이전 이전 값을 제거합니다

   - .-메시지를`pushed_once`에 저장합니다. \ (중복 감지에 사용,

     `PUSH_MSG_TIMEOUT * 5`ms 후에 제거됨 \ )

   - Retransmits the messages to its own push peers

3. 만료 : 노드가`PUSH_MSG_TIMEOUT`보다 오래된 푸시 메시지를

### 풀 메시지

노드는 알려진 피어의 활성 세트에서 푸시 피어를 무작위로 선택합니다. 노드는이 선택을 비교적 오랫동안 유지합니다. 정리 메시지가 수신되면 노드는 정리를 보낸 푸시 피어를 삭제합니다. 정리는 직접 푸시보다 해당 노드에 대한 또 다른 더 높은 지분 가중치 경로가 있음을 나타냅니다.

푸시 피어 세트는 'PUSH_MSG_TIMEOUT / 2'밀리 초마다 새 노드를 세트로 회전하여 최신 상태로 유지됩니다.

### 시간 및 지분 기반 가중치

노드는 클러스터에 새로운 정보가 있는지 묻는 풀 메시지를 보냅니다. 풀 메시지는 무작위로 단일 피어로 전송되며 이미 가지고있는 것을 나타내는 Bloom 필터로 구성됩니다. 풀 메시지를 수신하는 노드는 해당 값을 반복하고 필터를 놓치고 메시지에 맞는 것들에 대한 풀 응답을 구성합니다.

A node constructs the pull Bloom filter by iterating over current values and recently purged values.

노드는 현재 값과 최근에 제거 된 값을 반복하여 풀 블룸 필터를 구성합니다.

## Purging

Node는`purged_values` \ (내가 최근에 가지고 있던 것들 \)에서 \ (pull 또는 push로 업데이트 된 값 \)과 만료 된 값 \ (`GOSSIP_PULL_CRDS_TIMEOUT_MS` \)의 이전 버전을 유지합니다. 노드는`5 * GOSSIP_PULL_CRDS_TIMEOUT_MS`보다 오래된`purged_values`를 제거합니다.

## 이클립스 공격

An eclipse attack is an attempt to take over the set of node connections with adversarial endpoints.

이클립스 공격은 적대적인 엔드 포인트로 노드 연결 세트를 점령하려는 시도입니다.

- -풀 메시지는 네트워크에서 임의의 노드를 선택합니다. *pull*에 대한 이클립스 공격은 공격자가 끌어 오기를 위해 적대적 노드 만 선택되는 방식으로 무작위 선택에 영향을 주도록 요구합니다.
- -푸시 메시지는 활성 노드 세트를 유지하고 모든 푸시 메시지에 대해 임의의 팬 아웃을 선택합니다. *push*에 대한 일식 공격은 활성 세트 선택 또는 무작위 팬 아웃 선택에 영향을 미칩니다.

### 풀 메시지

이는 다음과 같은 방식으로 구현과 관련이 있습니다.

지분 가중치의`ln`을 사용하면 모든 노드가 합리적인 시간 내에 네트워크 커버리지의 공정한 기회를 얻을 수 있습니다. 노드간에 가능한 큰 '지분 가중치'차이를 정규화하는 데 도움이됩니다. 이런 식으로 '스테이킹 가중치'가 낮은 노드는 '스테이킹 가중치'가 큰 노드에 비해 몇 배의 ln \ (`stake` \) 초만 기다려야 선택됩니다.

가중치는 '마지막 선택 이후 시간'과 '지분 가중치'의 '자연 로그'를 기준으로 계산됩니다.

### 푸시 메시지

A node is selected as a pull target based on the weights described above.

### Push Message

공격자가 이러한 매개 변수에 영향을 미칠 수있는 방법은 없습니다.

위에서 설명한 가중치에 따라 풀 대상으로 노드가 선택됩니다.

## PlumTree와의 주목할만한 차이점

여기에 설명 된 활성 푸시 프로토콜은 \[Plum Tree\] (https://haslab.uminho.pt/sites/default/files/jop/files/lpr07a.pdf)를 기반으로합니다. 주요 차이점은 다음과 같습니다

- .-푸시 메시지에는 작성자가 서명 한 벽시계가 있습니다. wallclock이 만료되면 메시지가 삭제됩니다. 홉 제한은 적대적인 설정에서 구현하기 어렵습니다.
- -Lazy Push는 공격자가 메시지 지문을 위조하는 것을 방지하는 방법이 명확하지 않기 때문에 구현되지 않습니다. A naive approach would allow an adversary to be prioritized for pull based on their input.
